# Sort Tasks Implementation - Progress

## Status: COMPLETED âœ“

## Summary
Implemented status-aware chronological sorting for kanban board task columns using the `activity_at` field.

## Sorting Logic
- **Todo column**: Oldest first (ASC) - FIFO queue to prevent older tasks from being buried
- **All other columns** (In Progress, In Review, Done, Cancelled): Most recent activity first (DESC)

## Changes Made

### Backend (`crates/db/src/models/`)

#### `all_tasks.rs`
- Added `activity_at` field to `TaskWithProjectInfo` struct
- Added `activity_at` to SELECT clause in query
- Changed ORDER BY from `t.updated_at DESC` to `COALESCE(t.activity_at, t.created_at) DESC`

#### `task.rs`
- Changed ORDER BY in `find_by_project_id_with_attempt_status()` from `t.created_at DESC` to `COALESCE(t.activity_at, t.created_at) DESC`

### Frontend (`frontend/src/`)

#### `hooks/useProjectTasks.ts`
- Added `getActivityTime` helper function using `activity_at` with fallback to `created_at`
- Implemented status-aware sorting for `tasksByStatus`
- Implemented status-aware sorting for `sharedOnlyByStatus`

#### `pages/AllProjectsTasks.tsx`
- Added `getActivityTime` helper function
- Implemented status-aware sorting in `kanbanColumns` memo

#### `pages/ProjectTasks.tsx`
- Updated `getActivityTime` function to use `activity_at`
- Applied status-aware sorting (Todo ASC, others DESC)

### Type Generation
- Ran `npm run generate-types` to add `activity_at: Date | null` to TypeScript types

## Validation Results
- `cargo clippy --all --all-targets --all-features -- -D warnings` - PASSED
- `cargo test --workspace` - PASSED (all tests)
- `npx tsc --noEmit` - PASSED
- `npm run check` - PASSED

## Browser Testing (Session 1)
All tests passed with correct kanban board display:
- Desktop (1280x720) - Light mode: PASSED
- Desktop (1280x720) - Dark mode: PASSED
- Mobile (375x812) - Light mode: PASSED
- Tablet (768x1024) - Light mode: PASSED
- No console errors detected

## Screenshots
Screenshots saved to `.playwright-mcp/`:
- `test-light-mode-desktop.png`
- `test-dark-mode-desktop.png`
- `test-mobile-view.png`
- `test-tablet-view.png`

## Session 2 Verification
- Git status: Clean, all changes committed
- Branch up to date with origin/main
- All validation checks passing
- Code is merge-ready

## Commits
- `f145eaa85` - feat: implement status-aware task sorting with activity_at

## Notes
- The `activity_at` field tracks significant activity (status changes, execution starts)
- This is distinct from `updated_at` which tracks any modification
- SQLX offline mode was used for compilation due to mixed database schemas (SQLite local, PostgreSQL remote)
