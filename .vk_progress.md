# Task Labels Feature - Progress Tracker

## Status: needs-review

## Pull Request
(To be created after review)

## Overview
Add a Labels system to tasks for visual categorization with configurable names, icons (Lucide), and background colors (hex). Rename existing "Tags" to "Templates" throughout the codebase.

## Completed Items

### Step 1: Database & Backend (Tags→Templates rename) ✅
- [x] Created migration to rename `tags` → `templates`, `tag_name` → `template_name`
- [x] Renamed `crates/db/src/models/tag.rs` → `template.rs`
- [x] Updated struct `Tag` → `Template`
- [x] Renamed `crates/server/src/routes/tags.rs` → `templates.rs`
- [x] Updated route paths `/api/tags` → `/api/templates`
- [x] Updated `mod.rs` exports
- [x] Passed `cargo test` and `cargo clippy`

### Step 2: Database & Backend (Labels system) ✅
- [x] Created migration for `labels` + `task_labels` tables with indexes and defaults
- [x] Created `crates/db/src/models/label.rs` with Label, TaskLabel structs
- [x] Implemented CRUD methods + task association methods
- [x] Created `crates/server/src/routes/labels.rs` with endpoints
- [x] Added label middleware for route loading
- [x] Ran `npm run generate-types`
- [x] Passed all tests

### Step 3: Frontend (Templates rename + Labels API) ✅
- [x] Renamed `TagManager.tsx` → `TemplateManager.tsx`
- [x] Updated `tagsApi` → `templatesApi` in `lib/api.ts`
- [x] Added `labelsApi` namespace in `lib/api.ts`
- [x] Created `hooks/useLabels.ts` with query/mutation hooks
- [x] Updated i18n keys (en only)
- [x] Passed `npm run lint` and `npx tsc --noEmit`

### Step 4: Frontend (UI Components) ✅
- [x] Created `components/ui/icon-picker.tsx` - Lucide icon grid
- [x] Created `components/ui/color-picker.tsx` - Preset swatches + hex input
- [x] Created `components/labels/LabelBadge.tsx` - Single badge with icon/color
- [x] Created `components/labels/LabelBadgeList.tsx` - List for TaskCard
- [x] Passed lint/type checks

### Step 5: Frontend (Label Management) ✅
- [x] Created `LabelManager.tsx` - CRUD table for labels
- [x] Created `LabelEditDialog.tsx` - Create/edit dialog with IconPicker, ColorPicker
- [x] Integrated into GeneralSettings.tsx
- [x] Passed lint/type checks

### Step 6: Frontend (Task Integration) ✅
- [x] Created `components/labels/LabelPicker.tsx` - Multi-select popover
- [x] Added LabelPicker to `TaskFormDialog.tsx`
- [x] Added LabelBadgeList to `TaskCard.tsx`
- [x] Passed full validation: `npm run check`

### Step 7: Polish & i18n ✅
- [x] Added translations for ja, ko, es locales:
  - Updated `taskTemplates` title in settings.json (tags → templates)
  - Renamed "tags" section to "templates" in settings.json
  - Added full "labels" section in settings.json with translations for:
    - manager, dialog titles, table headers, action buttons
    - icon picker, color picker labels
    - delete confirmation messages
  - Added "labelsLabel" key in tasks.json
- [x] Manual testing completed:
  - Desktop view (1280x800) - light and dark mode
  - Mobile view (375x667) - light and dark mode
  - Tablet view (768x1024) - light and dark mode
  - Labels display correctly on TaskCard
  - Settings page Labels section functional
  - No console errors detected

## Files Modified

### Backend
| File | Change |
|------|--------|
| `crates/db/migrations/20241220_rename_tags_to_templates.sql` | Rename tags table |
| `crates/db/migrations/20241220_create_labels.sql` | Create labels tables |
| `crates/db/src/models/template.rs` | Renamed from tag.rs |
| `crates/db/src/models/label.rs` | New label model |
| `crates/db/src/models/mod.rs` | Updated exports |
| `crates/server/src/routes/templates.rs` | Renamed from tags.rs |
| `crates/server/src/routes/labels.rs` | New labels routes |
| `crates/server/src/routes/tasks.rs` | Added label endpoints |
| `crates/server/src/routes/mod.rs` | Updated exports |

### Frontend Components
| File | Change |
|------|--------|
| `frontend/src/components/TemplateManager.tsx` | Renamed from TagManager |
| `frontend/src/components/LabelManager.tsx` | New label management |
| `frontend/src/components/ui/icon-picker.tsx` | Lucide icon selector |
| `frontend/src/components/ui/color-picker.tsx` | Color picker with swatches |
| `frontend/src/components/labels/LabelBadge.tsx` | Single label badge |
| `frontend/src/components/labels/LabelBadgeList.tsx` | Badge list component |
| `frontend/src/components/labels/LabelPicker.tsx` | Multi-select picker |
| `frontend/src/components/dialogs/settings/TemplateEditDialog.tsx` | Renamed from TagEditDialog |
| `frontend/src/components/dialogs/settings/LabelEditDialog.tsx` | New label edit dialog |
| `frontend/src/components/dialogs/tasks/TaskFormDialog.tsx` | Added LabelPicker |
| `frontend/src/components/tasks/TaskCard.tsx` | Added LabelBadgeList |

### Frontend Hooks & API
| File | Change |
|------|--------|
| `frontend/src/lib/api.ts` | Added labelsApi, renamed templatesApi |
| `frontend/src/hooks/useLabels.ts` | New label hooks |

### i18n Translations
| File | Change |
|------|--------|
| `frontend/src/i18n/locales/en/settings.json` | Labels section, templates rename |
| `frontend/src/i18n/locales/ja/settings.json` | Japanese translations |
| `frontend/src/i18n/locales/ko/settings.json` | Korean translations |
| `frontend/src/i18n/locales/es/settings.json` | Spanish translations |
| `frontend/src/i18n/locales/en/tasks.json` | labelsLabel key |
| `frontend/src/i18n/locales/ja/tasks.json` | Japanese translation |
| `frontend/src/i18n/locales/ko/tasks.json` | Korean translation |
| `frontend/src/i18n/locales/es/tasks.json` | Spanish translation |

## API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| GET | `/api/labels?project_id={id}` | List labels (global + project-specific) |
| POST | `/api/labels` | Create label |
| GET | `/api/labels/{id}` | Get label |
| PUT | `/api/labels/{id}` | Update label |
| DELETE | `/api/labels/{id}` | Delete label |
| GET | `/api/tasks/{id}/labels` | Get task's labels |
| PUT | `/api/tasks/{id}/labels` | Set task's labels |
| GET | `/api/templates` | List templates (renamed from /api/tags) |
| POST | `/api/templates` | Create template |
| PUT | `/api/templates/{id}` | Update template |
| DELETE | `/api/templates/{id}` | Delete template |

## Default Labels

Three default labels are created on migration:
1. **Planning** - clipboard-list icon, amber color (#f59e0b)
2. **Implementation** - code icon, blue color (#3b82f6)
3. **Bug Fix** - bug icon, red color (#ef4444)

## Summary

All 7 steps of the Task Labels feature are now complete:
1. **Step 1**: Tags→Templates database rename
2. **Step 2**: Labels database tables and Rust models
3. **Step 3**: Frontend templates rename and labels API
4. **Step 4**: UI components (IconPicker, ColorPicker, LabelBadge)
5. **Step 5**: Label management in Settings
6. **Step 6**: Task integration (TaskFormDialog, TaskCard)
7. **Step 7**: i18n translations and browser testing

The feature allows users to:
- Create, edit, and delete labels with custom names, icons, and colors
- Assign multiple labels to tasks
- View label badges on task cards in the Kanban board
- Manage global and project-specific labels
- Use the system in English, Japanese, Korean, and Spanish
