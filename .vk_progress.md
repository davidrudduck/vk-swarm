# Bloat Removal Progress

**Plan file**: `/home/david/.claude/plans/dazzling-swinging-moore.md`
**Branch**: `dr/9484-bloat-removal`
**Status**: needs-review

## Session 1: Remove `react-window` (Unused Dependency) - COMPLETE

### Goal
Remove the unused `react-window` dependency from the frontend.

### Status: Completed

### Completed Items
- [x] Verified `react-window` is not used in codebase (only a comment reference in `logs.ts`)
- [x] Removed `react-window` dependency from `frontend/package.json`
- [x] Removed `@types/react-window` dependency from `frontend/package.json`
- [x] Updated comment in `frontend/src/types/logs.ts` to remove react-window reference
- [x] Ran `pnpm install` to update lockfile
- [x] Build passed successfully (`pnpm run build`)
- [x] Lint passed (255 pre-existing i18n warnings, no new issues)
- [x] TypeScript check passed (`npx tsc --noEmit`)
- [x] Browser testing completed:
  - Desktop view: working
  - Tablet view (768x1024): working
  - Mobile view (375x812): working
  - Dark mode: working
  - No react-window related console errors

### Files Modified
1. `frontend/package.json` - Removed 2 dependencies:
   - `"react-window": "^1.8.11"`
   - `"@types/react-window": "^1.8.8"`
2. `frontend/src/types/logs.ts` - Updated comment (removed "react-window key" reference)
3. `pnpm-lock.yaml` - Auto-updated

---

## Session 2: Remove Discord Link - COMPLETE

### Goal
Remove the Discord link from the navbar and all related configuration.

### Status: Completed

### Completed Items
- [x] Verified `useDiscordOnlineCount.ts` was already deleted (from previous session)
- [x] Removed Discord entry from `EXTERNAL_LINKS` array in `Navbar.tsx`
- [x] Removed unused `MessageCircle` import from `Navbar.tsx`
- [x] Build passed successfully (`pnpm run build`)
- [x] Lint passed (255 pre-existing i18n warnings, no new issues)
- [x] Backend tests passed (329 tests)
- [x] Browser testing completed:
  - Desktop view (1280x800): working, no Discord link in menu
  - Tablet view (768x1024): working, no Discord link in menu
  - Mobile view (375x812): working, no Discord link in menu
  - Dark mode: working, no Discord link in menu
  - No console errors

### Files Modified
1. `frontend/src/components/layout/Navbar.tsx`:
   - Removed `MessageCircle` from lucide-react imports
   - Removed Discord entry from `EXTERNAL_LINKS` array

### Notes
- The `useDiscordOnlineCount.ts` hook file was already deleted in a previous session
- The `hide_discord_link` setting was already removed from `DevBannerConfig` in `v8.rs`
- No Discord translation keys were found in i18n files (only English settings.json was checked, others didn't have Discord keys)

---

## Session 3: Remove Showcase/Onboarding Videos - COMPLETE

### Goal
Remove the showcase/onboarding video components and configuration from the codebase.

### Status: Completed

### Completed Items
- [x] Deleted showcase-related frontend files:
  - `frontend/src/config/showcases.ts`
  - `frontend/src/hooks/useVideoProgress.ts`
  - `frontend/src/components/dialogs/global/FeatureShowcaseDialog.tsx`
  - `frontend/src/components/showcase/ShowcaseStageMedia.tsx`
  - `frontend/src/types/showcase.ts`
- [x] Modified `frontend/src/pages/ProjectTasks.tsx`:
  - Removed `FeatureShowcaseDialog` import
  - Removed `showcases` import
  - Removed `useUserSystem` import (no longer used)
  - Removed showcase display logic (showcaseId, seenFeatures, seen, useEffect)
- [x] Removed `ShowcaseState` struct from Rust config versions:
  - `crates/services/src/services/config/versions/v7.rs` - Removed ShowcaseState struct definition
  - `crates/services/src/services/config/versions/v8.rs` - Removed ShowcaseState re-export and showcases field
  - `crates/services/src/services/config/versions/v9.rs` - Removed ShowcaseState re-export and showcases field
  - `crates/services/src/services/config/mod.rs` - Removed ShowcaseState type export
  - `crates/server/src/bin/generate_types.rs` - Removed ShowcaseState type generation
- [x] Updated tests in v9.rs to remove showcase JSON from test fixtures
- [x] Removed showcase translation keys from i18n files (4 files):
  - `frontend/src/i18n/locales/en/tasks.json`
  - `frontend/src/i18n/locales/es/tasks.json`
  - `frontend/src/i18n/locales/ja/tasks.json`
  - `frontend/src/i18n/locales/ko/tasks.json`
- [x] Backend build passed (`cargo build --workspace`)
- [x] Backend tests passed (`cargo test --workspace`)
- [x] Frontend build passed (`pnpm run build`)
- [x] Frontend lint passed (255 pre-existing i18n warnings, no new issues)
- [x] TypeScript check passed (`npx tsc --noEmit`)
- [x] TypeScript types regenerated (`pnpm -w run generate-types`)
- [x] Browser testing completed:
  - Desktop view (1280x800): working
  - Mobile view (375x812): working
  - Settings page: working
  - No JavaScript errors related to showcase removal
  - Note: Database errors during testing were environmental (worktree db setup), not related to code changes

### Files Deleted
1. `frontend/src/config/showcases.ts`
2. `frontend/src/hooks/useVideoProgress.ts`
3. `frontend/src/components/dialogs/global/FeatureShowcaseDialog.tsx`
4. `frontend/src/components/showcase/ShowcaseStageMedia.tsx`
5. `frontend/src/types/showcase.ts`

### Files Modified
1. `frontend/src/pages/ProjectTasks.tsx` - Removed showcase imports and logic
2. `crates/services/src/services/config/versions/v7.rs` - Removed ShowcaseState struct and showcases field
3. `crates/services/src/services/config/versions/v8.rs` - Removed ShowcaseState re-export and showcases field
4. `crates/services/src/services/config/versions/v9.rs` - Removed ShowcaseState re-export, showcases field, and test fixtures
5. `crates/services/src/services/config/mod.rs` - Removed ShowcaseState type export
6. `crates/server/src/bin/generate_types.rs` - Removed ShowcaseState type generation
7. `frontend/src/i18n/locales/en/tasks.json` - Removed showcases translation keys
8. `frontend/src/i18n/locales/es/tasks.json` - Removed showcases translation keys
9. `frontend/src/i18n/locales/ja/tasks.json` - Removed showcases translation keys
10. `frontend/src/i18n/locales/ko/tasks.json` - Removed showcases translation keys

---

## Session 4: Remove PostHog Analytics (Frontend) - COMPLETE

### Goal
Remove the PostHog analytics integration from the frontend, including the posthog-js package and all tracking calls.

### Status: Completed

### Completed Items
- [x] Removed `posthog-js` dependency from `frontend/package.json`
- [x] Removed PostHog environment variables from `frontend/src/vite-env.d.ts`
- [x] Removed PostHog initialization and `PostHogProvider` from `frontend/src/main.tsx`
- [x] Removed `usePostHog` hook and analytics opt-in/opt-out useEffect from `frontend/src/App.tsx`
- [x] Removed PostHog tracking calls from `frontend/src/pages/ProjectTasks.tsx`
- [x] Removed PostHog tracking calls from `frontend/src/components/panels/AttemptHeaderActions.tsx`
- [x] Removed analytics/telemetry checkbox from `frontend/src/pages/settings/GeneralSettings.tsx`
- [x] Removed telemetry translation keys from i18n files (4 files)
- [x] Ran `pnpm install` to update lockfile
- [x] Build passed successfully (`pnpm run build`)
- [x] Lint passed (255 pre-existing i18n warnings, no new issues)
- [x] TypeScript check passed (`npx tsc --noEmit`)
- [x] Backend build passed (`cargo build --workspace`)
- [x] Backend tests passed (`cargo test --workspace` - 328 tests)
- [x] Browser testing completed:
  - Desktop view (1280x800): working
  - Tablet view (768x1024): working
  - Mobile view (375x812): working
  - Dark mode: working
  - Light mode: working
  - Settings page: Privacy section now only shows "Enable Error Reporting" checkbox
  - No console errors related to PostHog removal

### Files Modified
1. `frontend/package.json` - Removed `posthog-js` dependency
2. `frontend/src/vite-env.d.ts` - Removed `VITE_PUBLIC_POSTHOG_KEY` and `VITE_PUBLIC_POSTHOG_HOST` env vars
3. `frontend/src/main.tsx` - Removed PostHog imports, initialization, and `PostHogProvider` wrapper
4. `frontend/src/App.tsx` - Removed `usePostHog` hook and analytics useEffect
5. `frontend/src/pages/ProjectTasks.tsx` - Removed `usePostHog` import and all `posthog?.capture()` calls
6. `frontend/src/components/panels/AttemptHeaderActions.tsx` - Removed `usePostHog` import and tracking calls
7. `frontend/src/pages/settings/GeneralSettings.tsx` - Removed telemetry checkbox from Privacy section
8. `frontend/src/i18n/locales/en/settings.json` - Removed telemetry translation keys
9. `frontend/src/i18n/locales/es/settings.json` - Removed telemetry translation keys
10. `frontend/src/i18n/locales/ja/settings.json` - Removed telemetry translation keys
11. `frontend/src/i18n/locales/ko/settings.json` - Removed telemetry translation keys

---

## Session 5: Remove PostHog Analytics (Backend) - COMPLETE

### Goal
Remove the PostHog analytics integration from the backend, including the analytics service, tracking calls in routes, environment variables, and config fields.

### Status: Completed

### Completed Items
- [x] Deleted `crates/services/src/services/analytics.rs` - Main PostHog analytics service
- [x] Removed analytics module from `crates/services/src/services/mod.rs`
- [x] Removed analytics from `crates/deployment/src/lib.rs`:
  - Removed `fn analytics(&self)` from Deployment trait
  - Removed `track_if_analytics_allowed` method
  - Updated `spawn_pr_monitor_service` to not pass analytics
- [x] Removed analytics from `crates/local-deployment/src/lib.rs`:
  - Removed AnalyticsContext import and struct field
  - Changed user_id generation to simple UUID (still needed for Sentry)
  - Removed analytics from container initialization
- [x] Removed analytics from `crates/local-deployment/src/container.rs`:
  - Removed analytics field from DeploymentContainer struct
  - Removed analytics parameter from `new()` method
  - Removed analytics tracking in spawn_exit_monitor
  - Fixed `config` variable references after analytics removal
  - Removed unused `serde_json::json` import
- [x] Removed analytics from `crates/services/src/services/pr_monitor.rs`:
  - Removed AnalyticsContext import
  - Removed analytics from struct and spawn method
  - Removed pr_merged tracking event
- [x] Removed POSTHOG env vars from `crates/server/build.rs`
- [x] Removed analytics tracking from `crates/server/src/main.rs` (session_start event)
- [x] Removed analytics tracking from route files:
  - `crates/server/src/routes/tasks.rs` - Removed all `track_if_analytics_allowed` calls
  - `crates/server/src/routes/task_attempts.rs` - Removed all analytics tracking calls
  - `crates/server/src/routes/oauth.rs` - Removed analytics auto-enable and tracking calls
  - `crates/server/src/routes/config.rs` - Removed `track_config_events` function entirely
  - `crates/server/src/routes/tags.rs` - Removed unused imports
  - `crates/server/src/routes/images.rs` - Removed unused imports
  - `crates/server/src/routes/projects.rs` - Removed unused imports
  - `crates/server/src/routes/approvals.rs` - Removed unused imports
  - `crates/server/src/routes/organizations.rs` - Removed unused import
  - `crates/server/src/routes/shared_tasks.rs` - No analytics to remove
- [x] Updated config versions:
  - `crates/services/src/services/config/versions/v9.rs` - Marked `analytics_enabled` as deprecated with `#[serde(default)]`
- [x] Removed PostHog section from `.env.example`
- [x] Backend build passed (`cargo build --workspace`)
- [x] Backend tests passed (`cargo test --workspace` - 327 tests)
- [x] Backend clippy passed (`cargo clippy --all --all-targets --all-features -- -D warnings`)
- [x] Browser testing completed:
  - Desktop view (1280x800): working
  - Tablet view (768x1024): working
  - Mobile view (375x812): working
  - Dark mode: working
  - Light mode: working
  - Settings page: Privacy section shows only "Enable Error Reporting" checkbox
  - No console errors or backend errors related to analytics removal

### Files Deleted
1. `crates/services/src/services/analytics.rs` - Main PostHog analytics service

### Files Modified
1. `crates/services/src/services/mod.rs` - Removed analytics module
2. `crates/deployment/src/lib.rs` - Removed analytics trait method and tracking helper
3. `crates/local-deployment/src/lib.rs` - Removed analytics initialization
4. `crates/local-deployment/src/container.rs` - Removed analytics field and tracking
5. `crates/services/src/services/pr_monitor.rs` - Removed analytics from PR monitor service
6. `crates/server/build.rs` - Removed POSTHOG env vars
7. `crates/server/src/main.rs` - Removed session_start tracking
8. `crates/server/src/routes/tasks.rs` - Removed all analytics tracking calls
9. `crates/server/src/routes/task_attempts.rs` - Removed all analytics tracking calls
10. `crates/server/src/routes/oauth.rs` - Removed analytics auto-enable and tracking
11. `crates/server/src/routes/config.rs` - Removed track_config_events function
12. `crates/server/src/routes/tags.rs` - Removed unused imports
13. `crates/server/src/routes/images.rs` - Removed unused imports
14. `crates/server/src/routes/projects.rs` - Removed unused imports
15. `crates/server/src/routes/approvals.rs` - Removed unused imports
16. `crates/server/src/routes/organizations.rs` - Removed unused import
17. `crates/services/src/services/config/versions/v9.rs` - Marked analytics_enabled as deprecated
18. `.env.example` - Removed PostHog section

### Notes
- The `analytics_enabled` field is kept in config v9 with `#[serde(default)]` for backward compatibility with existing user configs
- The `user_id` field is retained in LocalDeployment because it's still used by Sentry (will be addressed in Sessions 6-7)
- All analytics tracking events have been removed from the backend

---

## Remaining Work (Future Sessions)

| Session | Focus | Status |
|---------|-------|--------|
| 1 | Remove react-window | **Completed** |
| 2 | Remove Discord Link | **Completed** |
| 3 | Remove Showcase/Onboarding Videos | **Completed** |
| 4 | Remove PostHog Analytics (Frontend) | **Completed** |
| 5 | Remove PostHog Analytics (Backend) | **Completed** |
| 6 | Remove Sentry (Frontend) | Pending |
| 7 | Remove Sentry (Backend) | Pending |
| 8 | Final Verification & Cleanup | Pending |

### Next Session Recommendations
- Continue with Session 6: Remove Sentry (Frontend)
- This involves removing the Sentry integration from the frontend including @sentry/react package and error boundary
