{
  "db_name": "SQLite",
  "query": "\n            WITH RECURSIVE task_chain AS (\n                -- Base case: start with the requested task at depth 0\n                SELECT id, parent_task_id, CAST(0 AS INTEGER) as depth\n                FROM tasks\n                WHERE id = $1\n\n                UNION ALL\n\n                -- Recursive case: traverse to parent, incrementing depth\n                SELECT t.id, t.parent_task_id, CAST(tc.depth + 1 AS INTEGER)\n                FROM tasks t\n                INNER JOIN task_chain tc ON t.id = tc.parent_task_id\n            ),\n            -- Join variables with task chain and rank by depth per variable name\n            ranked_vars AS (\n                SELECT\n                    tv.name,\n                    tv.value,\n                    tc.id as source_task_id,\n                    tc.depth,\n                    ROW_NUMBER() OVER (PARTITION BY tv.name ORDER BY tc.depth ASC) as rn\n                FROM task_chain tc\n                INNER JOIN task_variables tv ON tv.task_id = tc.id\n            )\n            -- Select only the closest (lowest depth) variable for each name\n            SELECT\n                name as \"name!\",\n                value as \"value!\",\n                source_task_id as \"source_task_id!: Uuid\",\n                depth as \"depth!: i32\"\n            FROM ranked_vars\n            WHERE rn = 1\n            ORDER BY name ASC\n            ",
  "describe": {
    "columns": [
      {
        "name": "name!",
        "ordinal": 0,
        "type_info": "Text"
      },
      {
        "name": "value!",
        "ordinal": 1,
        "type_info": "Text"
      },
      {
        "name": "source_task_id!: Uuid",
        "ordinal": 2,
        "type_info": "Blob"
      },
      {
        "name": "depth!: i32",
        "ordinal": 3,
        "type_info": "Null"
      }
    ],
    "parameters": {
      "Right": 1
    },
    "nullable": [
      false,
      false,
      true,
      null
    ]
  },
  "hash": "0f7a1debde534a96401449cc17bfbab7273fb3835ccffa0852b1a4312e4a92e1"
}
