---
name: Fix React act() warning in UserMessage tests
status: open
created: 2026-01-20T22:56:20Z
updated: 2026-01-20T22:56:20Z
depends_on: []
conflicts_with: []
model_hint: simple
estimated_minutes: 15
---

# Task: Fix React act() warning in UserMessage tests

## Description
Fix the React act() warning that appears when clicking the expand/collapse button in UserMessage.test.tsx by properly wrapping state updates in act().

## Acceptance Criteria
- [ ] No React act() warnings in test output
- [ ] All existing tests still pass
- [ ] Button click test properly wrapped in act()

## Technical Details
When testing components that update state asynchronously (like the expand/collapse button), React Testing Library requires the update to be wrapped in act() to avoid warnings. The test at lines 111-130 clicks a button that triggers a state update but doesn't wrap it properly.

## Dependencies
- None

## Steps

### Step 1: Import act from React Testing Library
**File**: `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`

Update line 2 to include act:
```typescript
import { render, screen, act } from '@testing-library/react';
```

### Step 2: Wrap button click in act()
**File**: `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`

Find the test "uses translation key for collapse button aria-label when expanded" (lines 111-130).

Replace line 121:
```typescript
// Click to expand
button.click();
```

With:
```typescript
// Click to expand
act(() => {
  button.click();
});
```

## Files to Modify
- `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`
  - Add act import (line 2)
  - Wrap button.click() in act() (line 121)

## Code

### Import update (line 2)
```typescript
import { render, screen, act } from '@testing-library/react';
```

### Button click wrapped in act (replace line 121)
```typescript
// Click to expand
act(() => {
  button.click();
});
```

## Validation
- [ ] Tests run without warnings: `cd frontend && npm run test -- UserMessage.test.tsx`
- [ ] All tests pass
- [ ] No "not wrapped in act()" warnings appear

## Commit
```bash
test: fix React act() warning in UserMessage expand test

- Wrap button click in act() to properly handle state updates
- Import act from @testing-library/react
```

## Notes
- act() ensures that all updates related to state changes are processed before making assertions
- This is required by React Testing Library when testing components with state updates
- The warning appears because clicking the button triggers useExpandable state changes
