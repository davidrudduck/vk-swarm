---
name: Add unit test for resolve_container_ref
status: complete
created: 2026-01-23T08:42:27Z
updated: 2026-01-25T20:30:00Z
depends_on: [013]
parallel: false
conflicts_with: []
---

# Task: Add unit test for resolve_container_ref

## Description
Create a unit test that verifies `resolve_container_ref` correctly prioritizes attempts with running execution processes over attempts without.

## Acceptance Criteria
- [x] Test creates multiple task_attempts sharing same container_ref
- [x] Test creates execution_process with status='running' for one attempt
- [x] Test verifies resolve_container_ref returns the attempt with running process
- [x] Test uses db::test_utils::create_test_pool() for database
- [x] Test passes successfully
- [x] Code compiles without errors

## Technical Details
**File**: `crates/db/src/models/task_attempt.rs` or `crates/db/tests/task_attempt_test.rs`

Create a test like:
```rust
#[tokio::test]
async fn test_resolve_container_ref_prioritizes_running_process() {
    let (pool, _temp_dir) = create_test_pool().await;

    // Create project and task
    let project = Project::create(&pool, "test").await.unwrap();
    let task = Task::create(&pool, project.id, "test").await.unwrap();

    // Create two attempts with same container_ref
    let attempt1 = TaskAttempt::create(&pool, task.id, "/tmp/shared").await.unwrap();
    let attempt2 = TaskAttempt::create(&pool, task.id, "/tmp/shared").await.unwrap();

    // Create running execution_process for attempt2
    ExecutionProcess::create(&pool, attempt2.id, "running").await.unwrap();

    // Resolve should return attempt2 (has running process)
    let resolved = TaskAttempt::resolve_container_ref(&pool, "/tmp/shared").await.unwrap();
    assert_eq!(resolved.id, attempt2.id);
}
```

## Dependencies
- [ ] Task 013: resolve_container_ref query improved

## Effort Estimate
- Size: S
- Hours: 1
- Parallel: false (needs task 013 complete)

## Definition of Done
- [x] Test implemented
- [x] Test passes
- [x] Uses create_test_pool() for isolation
- [x] Code compiles without errors
- [x] Changes committed to git
