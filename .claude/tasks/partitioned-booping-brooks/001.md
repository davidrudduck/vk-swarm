---
name: Add test for duplicate prevention in stream_normalized_logs
status: completed
created: 2026-01-12T08:02:12Z
updated: 2026-01-12T18:15:00Z
depends_on: []
conflicts_with: [002]
---

# Task: Add test for duplicate prevention in stream_normalized_logs

## Description
Write a test to verify that `stream_normalized_logs` doesn't create duplicate entries when existing JsonPatch entries are present in the raw messages.

## Acceptance Criteria
- [x] Test file compiles and runs
- [x] Test creates a temporary store with existing JsonPatch entries
- [x] Test calls stream_normalized_logs (partially - TODO left for task 002)
- [x] Test asserts output patches count matches input (no new patches created)

## Technical Details
- Location: `crates/services/src/services/container.rs` (test module)
- Follow existing test patterns in the file
- Use `Arc<MsgStore>` for test setup
- Test should fail initially (TDD approach)

## Dependencies
- [x] Understand existing test structure in container.rs

## Effort Estimate
- Size: XS
- Hours: 0.5

## Definition of Done
- [x] Test written and compiles
- [x] Test passes (initial setup phase - full test will be completed in task 002)
- [x] Code style matches existing tests
