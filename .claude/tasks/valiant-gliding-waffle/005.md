---
name: Implement scan_session_files Function
status: complete
created: 2026-01-18T05:57:09Z
updated: 2026-01-18T10:42:00Z
depends_on: ['002']
conflicts_with: []
---

# Task: Implement scan_session_files Function

## Description
Implement function to scan Claude project directory for .jsonl session files, excluding agent- files and sessions-index.

## Acceptance Criteria
- [x] scan_session_files function implemented
- [x] Function finds all .jsonl files in directory
- [x] Function excludes files starting with 'agent-'
- [x] Function excludes 'sessions-index.jsonl'
- [x] Function returns Vec<PathBuf>

## Technical Details
Add to session_index.rs:

```rust
fn scan_session_files(project_dir: &Path) -> Result<Vec<PathBuf>, std::io::Error> {
    let mut sessions = Vec::new();
    for entry in std::fs::read_dir(project_dir)? {
        let entry = entry?;
        let path = entry.path();
        if path.extension().map_or(false, |e| e == "jsonl") {
            let name = path.file_stem().unwrap().to_string_lossy();
            if !name.starts_with("agent-") && name != "sessions-index" {
                sessions.push(path);
            }
        }
    }
    Ok(sessions)
}
```

## Dependencies
- [x] 002

## Effort Estimate
- Size: S
- Hours: 0.75

## Definition of Done
- [x] Function implemented
- [x] Filters work correctly
- [x] Test with sample directory passes
- [x] Error handling works

## Implementation Summary
Implemented `scan_session_files` function in `crates/executors/src/executors/session_index.rs` with comprehensive test coverage:

**Function Features:**
- Scans directory for .jsonl files
- Filters out files starting with 'agent-'
- Filters out 'sessions-index.jsonl'
- Returns Vec<PathBuf> of matching files
- Proper error handling for I/O operations

**Tests Added:**
1. `test_scan_session_files` - Tests filtering logic with mixed file types
2. `test_scan_session_files_empty_directory` - Tests empty directory handling
3. `test_scan_session_files_nonexistent_directory` - Tests error handling

**Test Results:**
All 7 tests in session_index module passing (7/7)

**Files Modified:**
- `crates/executors/src/executors/session_index.rs` - Added function and tests
- `crates/executors/Cargo.toml` - Added tempfile dev dependency
