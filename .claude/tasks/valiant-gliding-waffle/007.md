---
name: Implement repair_sessions_index Function
status: complete
created: 2026-01-18T05:57:09Z
updated: 2026-01-19T00:00:00Z
depends_on: ['002', '004', '005', '006']
conflicts_with: []
---

# Task: Implement repair_sessions_index Function

## Description
Implement the main repair function that scans for session files, checks for missing entries in the index, and rebuilds the index if needed.

## Acceptance Criteria
- [x] repair_sessions_index function implemented
- [x] Function reads existing index if present
- [x] Function scans for session files
- [x] Function identifies missing sessions
- [x] Function rebuilds and writes index only if needed
- [x] Function is async
- [x] Function logs repair actions

## Technical Details
Main repair logic:
1. Get Claude project directory from worktree path
2. Read existing sessions-index.json (if exists)
3. Scan for all .jsonl session files
4. Extract metadata from each file
5. Compare with existing index entries
6. If sessions missing, rebuild full index
7. Write updated index back to disk
8. Log actions with tracing::info/warn

Only repair if sessions are actually missing.

## Dependencies
- [x] 002
- [x] 004
- [x] 005
- [x] 006

## Effort Estimate
- Size: S
- Hours: 1.5

## Definition of Done
- [x] Function implemented
- [x] Reads existing index correctly
- [x] Detects missing sessions
- [x] Writes updated index
- [x] Logging in place
- [x] Tests pass
