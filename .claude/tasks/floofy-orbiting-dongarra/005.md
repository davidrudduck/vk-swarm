---
name: Update normalize_logs() to read JSON from stdout
status: complete
created: 2026-01-18T05:57:17Z
updated: 2026-01-18T11:05:00Z
depends_on: [003, 004]
conflicts_with: []
---

# Task: Update normalize_logs() to read JSON from stdout

## Description
Modify the `normalize_logs()` function to process raw JSON lines from stdout instead of `[oc-share]` prefixed lines.

## Acceptance Criteria
- [x] Stream filter changed from `[oc-share]` prefix to JSON object detection
- [x] Lines starting with `{` are captured
- [x] Invalid JSON lines are skipped gracefully
- [x] Code compiles successfully

## Technical Details
- Implementation approach: Replace filter logic to detect JSON objects
- Key considerations: Must handle non-JSON lines gracefully (stdout may contain other output)
- Code locations/files affected: `crates/executors/src/executors/opencode.rs` lines 272-322

**Current code:**
```rust
let share_events = msg_store
    .stdout_lines_stream()
    .filter(|line| ready(line.starts_with(Opencode::SHARE_PREFIX)))
    .map(|line| line[Opencode::SHARE_PREFIX.len()..].to_string())
    .boxed();
```

**Change to:**
```rust
let json_events = msg_store
    .stdout_lines_stream()
    .filter_map(|res| ready(res.ok()))
    .filter(|line| ready(line.starts_with('{')))
    .boxed();
```

## Dependencies
- [x] Task 003 (spawn methods updated to output JSON)
- [x] Task 004 (JSON event structs defined)

## Effort Estimate
- Size: XS
- Hours: 0.25

## Definition of Done
- [x] Code implemented
- [x] Code compiles
- [x] Stream correctly filters JSON lines
