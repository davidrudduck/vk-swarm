---
name: Remove share bridge from spawn() method
status: completed
created: 2026-01-18T05:57:17Z
updated: 2026-01-18T11:37:00Z
depends_on: [001]
conflicts_with: []
---

# Task: Remove share bridge from spawn() method

## Description
Remove all share bridge setup, subscription, and teardown code from the `spawn()` method, including environment variables for share bridge communication.

## Acceptance Criteria
- [x] `ShareBridge::start()` call removed
- [x] `OPENCODE_AUTO_SHARE` and `OPENCODE_API` environment variables removed
- [x] Bridge shutdown code removed
- [x] Share bridge subscription and forwarding task removed
- [x] Stdout capture retained for JSON events
- [x] Code compiles successfully

## Technical Details
- Implementation approach: Remove share bridge initialization and all related code
- Key considerations: Must keep stdout/stdin handling intact, only remove bridge-specific code
- Code locations/files affected: `crates/executors/src/executors/opencode.rs` lines 130-163

Removed:
- Line 132: `let bridge = ShareBridge::start().await.map_err(ExecutorError::Io)?;`
- Lines 147-148: `.env("OPENCODE_AUTO_SHARE", "1")` and `.env("OPENCODE_API", bridge.base_url.clone())`
- Lines 156-161: Bridge shutdown on spawn error
- Lines 171-181: Share bridge subscription and forwarding task
- Lines 183-190: Bridge shutdown on stdout close

Kept:
- Command setup and spawn
- Stdin prompt writing
- Stdout capture using `duplicate_stdout()` for JSON events

## Dependencies
- [x] Task 001 must be complete (command builder updated)

## Effort Estimate
- Size: S
- Hours: 0.5

## Definition of Done
- [x] Code implemented
- [x] Test written (`test_spawn_no_share_bridge_env_vars`)
- [x] Test written (`test_spawn_captures_stdout`)
- [x] Code compiles
- [x] Tests pass
