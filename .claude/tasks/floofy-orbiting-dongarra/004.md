---
name: Define JSON event struct types
status: complete
created: 2026-01-18T05:57:17Z
updated: 2026-01-18T10:55:00Z
depends_on: []
conflicts_with: []
---

# Task: Define JSON event struct types

## Description
Create Rust struct definitions for deserialising OpenCode JSON events from stdout.

## Acceptance Criteria
- [x] `JsonEvent` struct defined with all required fields
- [x] `JsonPart` struct defined with all required fields
- [x] `JsonTokens` struct defined for token usage tracking
- [x] Proper serde attributes applied for JSON field names
- [x] Code compiles successfully

## Technical Details
- Implementation approach: Define three structs with serde derives
- Key considerations: Field names use snake_case in Rust but must deserialise from JSON camelCase
- Code locations/files affected: `crates/executors/src/executors/opencode.rs` after line 395

Add these struct definitions:
```rust
#[derive(Debug, Clone, Deserialize)]
struct JsonEvent {
    #[serde(rename = "type")]
    event_type: String,
    timestamp: Option<i64>,
    #[serde(rename = "sessionID")]
    session_id: String,
    part: JsonPart,
}

#[derive(Debug, Clone, Deserialize)]
struct JsonPart {
    id: String,
    #[serde(rename = "messageID")]
    message_id: String,
    #[serde(rename = "type")]
    part_type: String,
    #[serde(default)]
    text: Option<String>,
    #[serde(default)]
    reason: Option<String>,
    #[serde(default)]
    tokens: Option<JsonTokens>,
}

#[derive(Debug, Clone, Deserialize)]
struct JsonTokens {
    input: u64,
    output: u64,
}
```

## Dependencies
- [ ] None - independent task

## Effort Estimate
- Size: XS
- Hours: 0.25

## Definition of Done
- [x] Structs defined
- [x] Test written (`test_json_event_parsing`)
- [x] Code compiles
- [x] Test deserialises sample JSON correctly
