---
name: Write tests for MCP failure status
status: completed
created: 2026-01-08T05:59:37Z
updated: 2026-01-09T11:00:00Z
depends_on: []
conflicts_with: []
---

# Task: Write tests for MCP failure status

## Description
Create tests to verify that MCP tool failures in Cursor executor are correctly marked as `ToolStatus::Failed` instead of always `Success`.

## Acceptance Criteria
- [x] Test: `test_mcp_failure_marked_as_failed` - `is_error=true` results in Failed
- [x] Test: `test_mcp_success_marked_as_success` - `is_error=false` results in Success
- [x] Test: `test_mcp_missing_is_error_defaults_success` - `None` defaults to Success

## Technical Details
- **File**: `crates/executors/src/executors/cursor.rs` (tests module)

```rust
#[test]
fn test_mcp_failure_marked_as_failed() {
    let result = CursorMcpResult {
        is_error: Some(true),
        content: vec![Content { text: "Error occurred".to_string() }],
    };
    let status = extract_tool_status(&result);
    assert_eq!(status, ToolStatus::Failed);
}

#[test]
fn test_mcp_success_marked_as_success() {
    let result = CursorMcpResult {
        is_error: Some(false),
        content: vec![Content { text: "Success".to_string() }],
    };
    let status = extract_tool_status(&result);
    assert_eq!(status, ToolStatus::Success);
}

#[test]
fn test_mcp_missing_is_error_defaults_success() {
    let result = CursorMcpResult {
        is_error: None,
        content: vec![Content { text: "OK".to_string() }],
    };
    let status = extract_tool_status(&result);
    assert_eq!(status, ToolStatus::Success);
}
```

## Dependencies
- [x] None

## Effort Estimate
- Size: S
- Hours: 1

## Definition of Done
- [x] Tests written
- [x] Tests compile

## Implementation Notes

### Changes Made

1. **Added `extract_tool_status` method to `CursorMcpResult`** (`cursor.rs:997-1012`):
   - Extracts `is_error` field from Flat, Wrapped, or Unknown variants
   - Returns `ToolStatus::Failed` when `is_error=Some(true)`
   - Returns `ToolStatus::Success` when `is_error=Some(false)` or `is_error=None`

2. **Added `PartialEq` derive to `ToolStatus`** (`logs/mod.rs:261`):
   - Required for `assert_eq!` comparisons in tests

3. **Added `PartialEq` derive to `QuestionOption` and `Question`** (`utils/approvals.rs:11,19`):
   - Required because `ToolStatus::PendingApproval` contains `Vec<Question>`

4. **Added 3 tests to cursor.rs tests module** (`cursor.rs:1292-1376`):
   - `test_mcp_failure_marked_as_failed`: Tests Flat, Wrapped success, and Wrapped failure variants with `is_error=true`
   - `test_mcp_success_marked_as_success`: Tests Flat and Wrapped variants with `is_error=false`
   - `test_mcp_missing_is_error_defaults_success`: Tests Flat, Wrapped, and Unknown variants with `is_error=None`

### Tests Verified
- All 66 executor tests pass
- All 3 MCP status tests pass
- Clippy passes with no warnings
