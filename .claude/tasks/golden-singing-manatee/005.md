---
name: Write test for normalization completion synchronization
status: open
created: 2026-01-08T05:59:37Z
updated: 2026-01-08T05:59:37Z
depends_on: []
conflicts_with: []
---

# Task: Write test for normalization completion synchronization

## Description
Create tests to verify that log normalization tasks complete before execution finalization, replacing the arbitrary 50ms sleep with proper async completion signals.

## Acceptance Criteria
- [ ] Test: `test_normalization_completes_before_finalization` - All entries exist after stop
- [ ] Test: `test_normalization_timeout` - Graceful handling of slow normalization
- [ ] Test: `test_fast_execution_no_lost_logs` - Very short executions preserve logs

## Technical Details
- Tests should verify that normalized log entries are in `log_entries` table after execution completes
- Test with various execution speeds (instant, short, normal)

```rust
#[tokio::test]
async fn test_normalization_completes_before_finalization() {
    // Start execution with logs
    // Trigger stop
    // Verify all normalized entries exist in log_entries table
}
```

## Dependencies
- [ ] None (test can be written first)

## Effort Estimate
- Size: S
- Hours: 1.5

## Definition of Done
- [ ] Tests written
- [ ] Tests compile (may fail initially until implementation)
