---
name: Write tests for .env loading in migrate_logs
status: open
created: 2026-01-08T05:59:37Z
updated: 2026-01-08T05:59:37Z
depends_on: [001]
conflicts_with: []
---

# Task: Write tests for .env loading in migrate_logs

## Description
Create integration tests to verify the migrate_logs binary correctly loads `.env` files and respects `VK_DATABASE_PATH`. Test both the happy path (custom path from env) and fallback path (default when no env).

## Acceptance Criteria
- [ ] Test file created: `crates/server/tests/migrate_logs_env_test.rs`
- [ ] Test: `test_database_path_from_env` - Verify `database_path()` uses `VK_DATABASE_PATH`
- [ ] Test: `test_default_path_when_no_env` - Verify fallback to default path works
- [ ] All tests pass

## Technical Details
- **File to create**: `crates/server/tests/migrate_logs_env_test.rs`
- Use `std::env::set_var` and `std::env::remove_var` for environment manipulation
- May need to call the `database_path()` function from `utils::assets`

```rust
#[test]
fn test_database_path_from_env() {
    std::env::set_var("VK_DATABASE_PATH", "/custom/path/db.sqlite");
    let path = utils::assets::database_path();
    assert_eq!(path, std::path::PathBuf::from("/custom/path/db.sqlite"));
    std::env::remove_var("VK_DATABASE_PATH");
}
```

## Dependencies
- [ ] Task 001: Add dotenvy call to migrate_logs binary

## Effort Estimate
- Size: S
- Hours: 1

## Definition of Done
- [ ] Tests written
- [ ] Tests pass: `cargo test --package server`
