---
name: Move Chevron to Bottom of Content
status: open
created: 2026-01-20T11:25:43Z
updated: 2026-01-20T11:25:43Z
depends_on: ["001"]
conflicts_with: []
model_hint: moderate
estimated_minutes: 30
---

# Task: Move Chevron to Bottom of Content

## Description
Move the expand/collapse chevron from the header to the bottom of the content area. This provides a clearer visual indicator that there is more content to expand when messages are collapsed.

## Acceptance Criteria
- [ ] Chevron appears at the bottom of content area (not in header)
- [ ] Chevron only appears when message exceeds 5 lines
- [ ] Chevron rotates 180Â° when expanded
- [ ] Clicking chevron expands/collapses message
- [ ] All tests pass

## Technical Details
**Current layout:**
```text
Header: [Executor] [Chevron] [Edit]
Content: [Markdown only]
```

**New layout:**
```text
Header: [Executor] [Edit]
Content: [Markdown] [Chevron button at bottom]
```

The chevron should be a full-width button at the bottom of the content area with hover effects.

## Dependencies
- Task 001 must be completed first (fixes group class placement)

## Steps

### Step 1: Write failing test for chevron at bottom
**File**: `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`

Add these tests:
```typescript
describe('expand/collapse chevron', () => {
  it('renders chevron at bottom of content when message exceeds 5 lines', () => {
    const longContent = 'Line 1\nLine 2\nLine 3\nLine 4\nLine 5\nLine 6';
    const { container } = render(<UserMessage content={longContent} />);
    // Chevron should be in content area, not header
    const contentArea = container.querySelector('[class*="contentBg"]');
    const chevronButton = contentArea?.querySelector('button[aria-label]');
    expect(chevronButton).toBeInTheDocument();
  });

  it('does not render chevron when message is 5 lines or less', () => {
    const shortContent = 'Line 1\nLine 2\nLine 3\nLine 4\nLine 5';
    const { container } = render(<UserMessage content={shortContent} />);
    const chevronButton = container.querySelector('button[aria-label*="Expand"]');
    expect(chevronButton).not.toBeInTheDocument();
  });
});
```

### Step 2: Remove chevron from header
**File**: `frontend/src/components/NormalizedConversation/UserMessage.tsx`
**Location**: Around lines 118-131

Delete this entire block (the chevron button in the header):
```typescript
{needsCollapse && (
  <button
    onClick={(e) => {
      e.preventDefault();
      toggle();
    }}
    className={...}
    aria-label={expanded ? 'Collapse message' : 'Expand message'}
  >
    <ChevronDown ... />
  </button>
)}
```

### Step 3: Add chevron after markdown content
**File**: `frontend/src/components/NormalizedConversation/UserMessage.tsx`
**Location**: After MarkdownRenderer, inside the content div (around line 155)

Find the section that renders MarkdownRenderer:
```typescript
{showRetryEditor ? (
  <RetryEditorInline ... />
) : (
  <MarkdownRenderer
    content={displayContent}
    className="whitespace-pre-wrap break-words flex flex-col gap-1 font-light"
  />
)}
```

Replace with:
```typescript
{showRetryEditor ? (
  <RetryEditorInline ... />
) : (
  <>
    <MarkdownRenderer
      content={displayContent}
      className="whitespace-pre-wrap break-words flex flex-col gap-1 font-light"
    />
    {needsCollapse && (
      <button
        onClick={(e) => { e.preventDefault(); toggle(); }}
        className={cn(
          'w-full flex justify-center pt-2 -mb-1',
          'hover:bg-green-100 dark:hover:bg-green-900/30 rounded-b'
        )}
        aria-label={expanded ? 'Collapse message' : 'Expand message'}
      >
        <ChevronDown
          className={cn(
            'w-5 h-5 transition-transform',
            USER_MESSAGE_APPEARANCE.headerText,
            expanded && 'rotate-180'
          )}
        />
      </button>
    )}
  </>
)}
```

### Step 4: Run tests
```bash
cd frontend
npm run test -- UserMessage.test.tsx
```

All tests should pass.

## Files to Modify
- `frontend/src/components/NormalizedConversation/UserMessage.tsx` - Remove chevron from header, add to content bottom
- `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx` - Add tests for chevron position

## Validation
- [ ] Run `cd frontend && npm run test -- UserMessage.test.tsx`
- [ ] Run `cd frontend && npx tsc --noEmit`
- [ ] Visually verify chevron appears at bottom of collapsed messages
- [ ] Visually verify chevron rotates when expanding
- [ ] Visually verify hover effect on chevron button

## Commit
```bash
feat: move expand chevron to bottom of UserMessage content

- Remove chevron from header
- Add chevron button at bottom of content area
- Add hover effects for better UX
- Update tests for new chevron position
```

## Notes
- The chevron button spans the full width for better click target
- Hover effect uses green color to match other interactive elements
- The `rotate-180` class smoothly rotates the chevron when expanded
- The `-mb-1` negative margin helps align with the border
