---
name: Add Executor Variant Display
status: open
created: 2026-01-20T11:25:43Z
updated: 2026-01-20T11:25:43Z
depends_on: []
conflicts_with: ["001", "002", "003"]
model_hint: moderate
estimated_minutes: 30
---

# Task: Add Executor Variant Display

## Description
Add support for displaying the executor variant (e.g., "PLAN", "DEFAULT") alongside the executor name in the UserMessage header. Currently, the variant information exists in ExecutionProcess but is not extracted or displayed.

## Acceptance Criteria
- [ ] Executor variant extracted from ExecutionProcess data
- [ ] Variant displayed in header as "EXECUTOR / VARIANT" when available
- [ ] Only executor shown when variant is null
- [ ] All tests pass
- [ ] No TypeScript errors

## Technical Details
**Data flow:**
```bash
ExecutionProcess.executor_action.typ.executor_profile_id.variant
    ↓ extract in DisplayConversationEntry
UserMessage (receives executorVariant prop)
    ↓ display in header
Header shows: "CLAUDE_CODE / PLAN" or just "CLAUDE_CODE"
```

**Current display:**
```text
CLAUDE_CODE
```

**New display with variant:**
```text
CLAUDE_CODE / PLAN
```

## Dependencies
This task can run in parallel with tasks 001-003 since it modifies different parts of the code.

## Steps

### Step 1: Write failing test for variant display
**File**: `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`

Add these tests:
```typescript
describe('executor variant display', () => {
  it('displays executor variant when provided', () => {
    const mockTaskAttempt = { id: 'test', executor: 'CLAUDE_CODE' };
    render(
      <UserMessage
        content="Test"
        taskAttempt={mockTaskAttempt as TaskAttempt}
        executorVariant="PLAN"
      />
    );
    expect(screen.getByText('CLAUDE_CODE / PLAN')).toBeInTheDocument();
  });

  it('displays only executor when variant is null', () => {
    const mockTaskAttempt = { id: 'test', executor: 'CLAUDE_CODE' };
    render(
      <UserMessage
        content="Test"
        taskAttempt={mockTaskAttempt as TaskAttempt}
        executorVariant={null}
      />
    );
    expect(screen.getByText('CLAUDE_CODE')).toBeInTheDocument();
    expect(screen.queryByText('/')).not.toBeInTheDocument();
  });
});
```

### Step 2: Add executorVariant prop to UserMessage component
**File**: `frontend/src/components/NormalizedConversation/UserMessage.tsx`

Find the component props definition (around line 50-60) and add the new prop:
```typescript
const UserMessage = ({
  content,
  executionProcessId,
  taskAttempt,
  executorVariant,  // ADD THIS
}: {
  content: string;
  executionProcessId?: string;
  taskAttempt?: TaskAttempt;
  executorVariant?: string | null;  // ADD THIS
}) => {
```

### Step 3: Update executor display logic
**File**: `frontend/src/components/NormalizedConversation/UserMessage.tsx`

Find where the executor is displayed (around line 70-80):
```typescript
const executor = taskAttempt?.executor;
const variant = null;  // This line currently exists
```

Change to:
```typescript
const executor = taskAttempt?.executor;
const variant = executorVariant ?? null;  // Use prop instead of hardcoded null
```

The display logic should already handle the variant correctly (showing "EXECUTOR / VARIANT" when variant exists).

### Step 4: Extract variant in DisplayConversationEntry
**File**: `frontend/src/components/NormalizedConversation/DisplayConversationEntry.tsx`

Add this helper function near the top of the file (after imports):
```typescript
/**
 * Extract executor variant from execution process data
 */
const getExecutorVariant = (execProcess?: ExecutionProcess): string | null => {
  if (!execProcess?.executor_action?.typ) return null;
  const typ = execProcess.executor_action.typ;
  if (typ.type === 'CodingAgentInitialRequest' || typ.type === 'CodingAgentFollowUpRequest') {
    return typ.executor_profile_id?.variant ?? null;
  }
  return null;
};
```

### Step 5: Pass variant to UserMessage
**File**: `frontend/src/components/NormalizedConversation/DisplayConversationEntry.tsx`

Find where UserMessage is rendered (around line 818-826). Change:
```typescript
// Before:
<UserMessage
  content={entry.content}
  executionProcessId={executionProcessId}
  taskAttempt={taskAttempt}
/>

// After:
<UserMessage
  content={entry.content}
  executionProcessId={executionProcessId}
  taskAttempt={taskAttempt}
  executorVariant={getExecutorVariant(executionProcess)}
/>
```

### Step 6: Run tests
```bash
cd frontend
npm run test -- UserMessage.test.tsx
```

All tests should pass.

## Files to Modify
- `frontend/src/components/NormalizedConversation/UserMessage.tsx` - Add executorVariant prop, use it for variant
- `frontend/src/components/NormalizedConversation/DisplayConversationEntry.tsx` - Extract variant, pass to UserMessage
- `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx` - Add tests for variant display

## Validation
- [ ] Run `cd frontend && npm run test -- UserMessage.test.tsx`
- [ ] Run `cd frontend && npx tsc --noEmit`
- [ ] Visually verify variant displays when present (need test data with variant)
- [ ] Verify no variant displays "/" when variant is null

## Commit
```bash
feat: display executor variant in UserMessage header

- Add executorVariant prop to UserMessage component
- Extract variant from ExecutionProcess in DisplayConversationEntry
- Display as "EXECUTOR / VARIANT" when variant exists
- Add tests for variant display logic
```

## Notes
- The variant is extracted from `ExecutionProcess.executor_action.typ.executor_profile_id.variant`
- This only works for `CodingAgentInitialRequest` and `CodingAgentFollowUpRequest` types
- The display format "EXECUTOR / VARIANT" is already implemented, we just need to pass the variant
- If variant is null/undefined, only the executor name is shown (no "/")
