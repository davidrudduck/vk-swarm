---
name: Add Translations for Accessibility
status: open
created: 2026-01-20T11:25:43Z
updated: 2026-01-20T11:25:43Z
depends_on: ["002"]
conflicts_with: []
model_hint: moderate
estimated_minutes: 30
---

# Task: Add Translations for Accessibility

## Description
Add internationalization (i18n) support for aria-labels in the UserMessage component. Replace hardcoded English strings with translation keys to support screen readers in all supported languages (English, Japanese, Korean, Spanish).

## Acceptance Criteria
- [ ] All aria-labels use translation keys via `useTranslation` hook
- [ ] Translation keys added to all 4 locale files (en, ja, ko, es)
- [ ] Tests updated to mock i18n
- [ ] All tests pass
- [ ] No TypeScript errors

## Technical Details
The UserMessage component currently has hardcoded aria-labels:
- `"Expand message"` / `"Collapse message"` - for chevron button
- `"Edit message"` - for edit button (if it exists)

These need to be replaced with `t()` calls using react-i18next.

## Dependencies
- Task 002 must be completed (chevron moved to bottom)

## Steps

### Step 1: Add i18n mock to test file
**File**: `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`

Add this at the top of the file (before the first import):
```typescript
import { vi } from 'vitest';

vi.mock('react-i18next', () => ({
  useTranslation: () => ({
    t: (key: string) => key,
  }),
}));
```

### Step 2: Write failing test for translation usage
**File**: `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`

Add this test:
```typescript
describe('accessibility translations', () => {
  it('uses translation key for expand button aria-label', () => {
    const longContent = 'Line 1\nLine 2\nLine 3\nLine 4\nLine 5\nLine 6';
    render(<UserMessage content={longContent} />);
    const expandButton = screen.getByRole('button', {
      name: 'conversation.userMessage.expandMessage'
    });
    expect(expandButton).toBeInTheDocument();
  });
});
```

### Step 3: Add translation keys to English locale
**File**: `frontend/src/i18n/locales/en/common.json`

Find the `"conversation"` section and add the `"userMessage"` subsection:
```json
"conversation": {
  "userMessage": {
    "showMore": "Show more",
    "showLess": "Show less",
    "expandMessage": "Expand message",
    "collapseMessage": "Collapse message",
    "editMessage": "Edit message"
  }
}
```

### Step 4: Add translation keys to Japanese locale
**File**: `frontend/src/i18n/locales/ja/common.json`

Find the `"conversation"` section and add:
```json
"conversation": {
  "userMessage": {
    "showMore": "もっと見る",
    "showLess": "少なく表示",
    "expandMessage": "メッセージを展開",
    "collapseMessage": "メッセージを折りたたむ",
    "editMessage": "メッセージを編集"
  }
}
```

### Step 5: Add translation keys to Korean locale
**File**: `frontend/src/i18n/locales/ko/common.json`

Find the `"conversation"` section and add:
```json
"conversation": {
  "userMessage": {
    "showMore": "더 보기",
    "showLess": "간략히 보기",
    "expandMessage": "메시지 펼치기",
    "collapseMessage": "메시지 접기",
    "editMessage": "메시지 편집"
  }
}
```

### Step 6: Add translation keys to Spanish locale
**File**: `frontend/src/i18n/locales/es/common.json`

Find the `"conversation"` section and add:
```json
"conversation": {
  "userMessage": {
    "showMore": "Mostrar más",
    "showLess": "Mostrar menos",
    "expandMessage": "Expandir mensaje",
    "collapseMessage": "Contraer mensaje",
    "editMessage": "Editar mensaje"
  }
}
```

### Step 7: Add useTranslation hook to UserMessage component
**File**: `frontend/src/components/NormalizedConversation/UserMessage.tsx`

At the top of the file, add the import:
```typescript
import { useTranslation } from 'react-i18next';
```

Inside the component function (after the opening `const UserMessage = ({...}) => {`), add:
```typescript
const { t } = useTranslation('common');
```

### Step 8: Replace hardcoded aria-labels with translations
**File**: `frontend/src/components/NormalizedConversation/UserMessage.tsx`

Find the chevron button's aria-label and change:
```typescript
// Before:
aria-label={expanded ? 'Collapse message' : 'Expand message'}

// After:
aria-label={expanded
  ? t('conversation.userMessage.collapseMessage')
  : t('conversation.userMessage.expandMessage')}
```

If there's an edit button with aria-label, change:
```typescript
// Before:
aria-label="Edit message"

// After:
aria-label={t('conversation.userMessage.editMessage')}
```

### Step 9: Run tests
```bash
cd frontend
npm run test -- UserMessage.test.tsx
```

All tests should pass.

## Files to Modify
- `frontend/src/components/NormalizedConversation/UserMessage.tsx` - Add useTranslation, use t() for aria-labels
- `frontend/src/i18n/locales/en/common.json` - Add English translations
- `frontend/src/i18n/locales/ja/common.json` - Add Japanese translations
- `frontend/src/i18n/locales/ko/common.json` - Add Korean translations
- `frontend/src/i18n/locales/es/common.json` - Add Spanish translations
- `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx` - Add i18n mock and test

## Validation
- [ ] Run `cd frontend && npm run test -- UserMessage.test.tsx`
- [ ] Run `cd frontend && npx tsc --noEmit`
- [ ] Manually test with browser language set to each locale
- [ ] Verify screen reader announces correct language

## Commit
```bash
feat: add i18n support for UserMessage aria-labels

- Add translation keys for expand/collapse/edit messages
- Add translations for en, ja, ko, es locales
- Replace hardcoded aria-labels with t() calls
- Add i18n mock to tests
```

## Notes
- The i18n mock in tests returns the translation key itself, making it easy to verify correct keys are used
- Translation keys follow the pattern: `conversation.userMessage.{action}`
- Japanese translations use polite form (です/ます体)
- Korean translations use standard polite form (합니다체)
