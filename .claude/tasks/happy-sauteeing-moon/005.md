---
name: Implement reject_if_remote helper function
status: done
created: 2026-01-12T00:16:47Z
updated: 2026-01-12T00:55:00Z
depends_on: [002, 003, 004]
conflicts_with: [006, 007]
---

# Task: Implement reject_if_remote helper function

## Description
Implement the `reject_if_remote` helper function that checks if a task attempt belongs to a remote project and returns `BadRequest` if so. This is the GREEN phase - making tests pass.

## Acceptance Criteria
- [x] Function `reject_if_remote` implemented in `message_queue.rs`
- [x] Function signature: `async fn reject_if_remote(pool: &sqlx::SqlitePool, task_attempt: &TaskAttempt) -> Result<(), ApiError>`
- [x] Returns `Err(ApiError::NotFound)` if task doesn't exist
- [x] Returns `Err(ApiError::NotFound)` if project doesn't exist
- [x] Returns `Err(ApiError::BadRequest)` if project.is_remote is true
- [x] Returns `Ok(())` for local projects
- [x] Includes debug-level tracing when rejecting remote requests
- [x] All three test cases pass

## Technical Details
- Implementation approach:
  1. Add imports for `Project` and `Task` models
  2. Implement helper function after imports, before handlers
  3. Use `Task::find_by_id` and `Project::find_by_id` for lookups
  4. Add tracing::debug! when rejecting remote projects
- Key considerations:
  - Error message must be "Cannot modify message queue for remote task attempts"
  - Must import `db::models::{project::Project, task::Task}`
- Code locations/files affected: `crates/server/src/routes/message_queue.rs`

## Dependencies
- [x] Task 002 - test for remote rejection
- [x] Task 003 - test for local allowance
- [x] Task 004 - test for missing task

## Effort Estimate
- Size: S
- Hours: 0.5

## Definition of Done
- [x] Code implemented
- [x] All three tests pass: `cargo test -p server message_queue`
- [x] No clippy warnings
