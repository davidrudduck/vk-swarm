---
name: Update TemplatePicker to use unified API
status: open
created: 2026-01-19T12:00:00Z
updated: 2026-01-19T12:00:00Z
depends_on: ["005"]
conflicts_with: []
model_hint: moderate
estimated_minutes: 30
---

# Task: Update TemplatePicker to use unified API

## Goal
Replace hardcoded DEFAULT_TEMPLATES with API call to `/api/templates/all`.

## Context
The TemplatePicker component currently has hardcoded templates (DEFAULT_TEMPLATES constant, lines 34-129). We need to replace this with an API call to fetch templates dynamically.

**File location**: `frontend/src/components/tasks/TemplatePicker.tsx`

The component already has `loading`, `error`, and `onRetry` props for handling loading states.

## Steps
1. Add `useQuery` import from `@tanstack/react-query`
2. Add `templatesApi` import
3. Add `UnifiedTemplate` type import
4. Remove or comment out the `DEFAULT_TEMPLATES` constant (lines 34-129)
5. Update the `Template` interface to add `source` field
6. Add useQuery hook inside the component to fetch templates
7. Update the `allTemplates` memo to use fetched data
8. Combine loading/error states

## Files to Modify
- `frontend/src/components/tasks/TemplatePicker.tsx` - Multiple changes

## Code

### Step 1-3: Add imports

Add after the existing imports (around line 18):

```typescript
import { useQuery } from '@tanstack/react-query';
import { templatesApi } from '@/lib/api/templates';
import type { UnifiedTemplate } from 'shared/types';
```

### Step 4: Remove DEFAULT_TEMPLATES

Delete or comment out lines 34-129 (the entire `DEFAULT_TEMPLATES` constant).

### Step 5: Update Template interface

Change the `Template` interface (around line 23-29):

From:
```typescript
export interface Template {
  id: string;
  name: string;
  description: string;
  content: string;
  icon?: React.ReactNode;
}
```

To:
```typescript
export interface Template {
  id: string;
  name: string;
  description: string;
  content: string;
  icon?: React.ReactNode;
  source?: string;
}
```

### Step 6: Add useQuery inside component

Inside the `TemplatePicker` component function, after the `useState` for `searchQuery` (around line 192), add:

```typescript
  // Fetch all templates from API
  const {
    data: fetchedTemplates,
    isLoading: templatesLoading,
    error: templatesError,
    refetch: refetchTemplates,
  } = useQuery({
    queryKey: ['templates', 'all'],
    queryFn: () => templatesApi.listAll(),
    staleTime: 5 * 60 * 1000, // 5 minutes
  });
```

### Step 7: Update allTemplates memo

Replace the existing `allTemplates` memo:

From:
```typescript
  const allTemplates = useMemo(() => {
    const templates: Template[] = [];
    if (showDefaults) {
      templates.push(...DEFAULT_TEMPLATES);
    }
    templates.push(...customTemplates);
    return templates;
  }, [showDefaults, customTemplates]);
```

To:
```typescript
  // Map fetched templates to Template interface and combine with custom templates
  const allTemplates = useMemo(() => {
    const templates: Template[] = [];

    // Add fetched templates from API
    if (fetchedTemplates) {
      for (const t of fetchedTemplates) {
        templates.push({
          id: t.id,
          name: t.name,
          description: t.description || `${t.source} template`,
          content: t.content,
          source: t.source,
        });
      }
    }

    // Add custom templates passed as props
    templates.push(...customTemplates);

    return templates;
  }, [fetchedTemplates, customTemplates]);
```

### Step 8: Combine loading/error states

Find where loading/error are used in the component. Update the variables used for rendering:

Add after the `allTemplates` memo:

```typescript
  // Combine loading states from props and fetch
  const isLoading = loading || templatesLoading;
  const errorMessage = error || (templatesError ? 'Failed to load templates' : null);
  const handleRetry = onRetry || (() => refetchTemplates());
```

Then update the JSX to use `isLoading`, `errorMessage`, and `handleRetry` instead of `loading`, `error`, and `onRetry`.

In the loading section (around line 293):
```typescript
{isLoading && (
```

In the error section (look for `error &&`):
```typescript
{errorMessage && !isLoading && (
```

And the retry button should call `handleRetry`:
```typescript
onClick={handleRetry}
```

### Note on showDefaults prop

The `showDefaults` prop is no longer needed since templates come from the API. You can either:
- Ignore it (API returns all templates including system ones)
- Remove it from the props interface and component signature

For minimal changes, just ignore it - the API handles which templates to show.

## Verification
- [ ] Run `cd frontend && npm run lint` - passes
- [ ] Run `cd frontend && npx tsc --noEmit` - succeeds
- [ ] Template picker shows templates from API when opened
- [ ] Loading state displays while fetching
- [ ] Error state displays if fetch fails

## Commit
`feat(frontend): update TemplatePicker to use unified templates API`

## Notes
- The `showDefaults` prop becomes a no-op since the API controls what templates are returned
- The `staleTime` of 5 minutes means templates are cached and not refetched on every open
- Custom templates passed via props are still appended after API templates
- The `source` field is now available for display if needed (e.g., showing a badge)
- React Query handles caching, so subsequent opens are instant
