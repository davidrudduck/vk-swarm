---
name: Update Project queries for stop_script
status: open
created: 2026-01-19T12:00:00Z
updated: 2026-01-19T12:00:00Z
depends_on: ["015"]
conflicts_with: []
model_hint: moderate
estimated_minutes: 30
---

# Task: Update Project queries for stop_script

## Goal
Update SQL queries to include stop_script in select, insert, and update.

## Context
After adding `stop_script` to the Project model (Task 015), the SQL queries need to be updated to include the new column.

**File location**: `crates/db/src/models/project/queries.rs`

This file contains multiple query functions that need to be updated:
- `find_all` - SELECT all projects
- `find_most_active` - SELECT with join
- `find_by_id` - SELECT single project
- `find_by_git_repo_path` - SELECT by path
- `create` - INSERT new project
- `update` - UPDATE existing project

Each query that returns a `Project` struct needs `stop_script` added to the column list.

## Steps
1. Update all SELECT queries to include `stop_script` column
2. Update INSERT query to include `stop_script`
3. Update UPDATE query to include `stop_script`

## Files to Modify
- `crates/db/src/models/project/queries.rs` - Multiple query updates

## Code

### Pattern for SELECT queries

For each SELECT query, add `stop_script,` after `cleanup_script,` in the column list.

Example pattern - find in each query:
```sql
cleanup_script,
copy_files,
```

Change to:
```sql
cleanup_script,
stop_script,
copy_files,
```

### Specific queries to update:

#### 1. find_all (around line 16-47)

Find:
```rust
r#"SELECT id as "id!: Uuid",
          name,
          git_repo_path,
          setup_script,
          dev_script,
          cleanup_script,
          copy_files,
```

Change to:
```rust
r#"SELECT id as "id!: Uuid",
          name,
          git_repo_path,
          setup_script,
          dev_script,
          cleanup_script,
          stop_script,
          copy_files,
```

#### 2. find_most_active (around line 51-81)

Find:
```rust
SELECT p.id as "id!: Uuid", p.name, p.git_repo_path, p.setup_script, p.dev_script, p.cleanup_script, p.copy_files,
```

Change to:
```rust
SELECT p.id as "id!: Uuid", p.name, p.git_repo_path, p.setup_script, p.dev_script, p.cleanup_script, p.stop_script, p.copy_files,
```

#### 3. find_by_id (around line 83-115)

Same pattern as find_all - add `stop_script,` after `cleanup_script,`

#### 4. find_by_git_repo_path (around line 117-150)

Same pattern as find_all - add `stop_script,` after `cleanup_script,`

#### 5. There may be more SELECT queries

Search the file for all occurrences of `cleanup_script,` and add `stop_script,` after each one.

### INSERT query (create function)

Find the create function and update the INSERT statement:

Look for something like:
```sql
INSERT INTO projects (id, name, git_repo_path, setup_script, dev_script, cleanup_script, copy_files, ...)
VALUES ($1, $2, $3, $4, $5, $6, $7, ...)
```

Add `stop_script` to the column list and add a corresponding parameter placeholder.

Also update the Rust code that passes values to include `data.stop_script`.

### UPDATE query (update function)

Find the update function and add `stop_script` to the SET clause:

Look for something like:
```sql
SET name = $2, git_repo_path = $3, setup_script = $4, dev_script = $5, cleanup_script = $6, ...
```

Add `stop_script = $N,` with the appropriate parameter number.

Also update the Rust code to handle `data.stop_script`.

## Verification
- [ ] Run `cargo check -p db` - should succeed with no errors
- [ ] Run `cargo test -p db` - all tests pass
- [ ] Run `cargo sqlx prepare --workspace` if the project uses offline sqlx

## Commit
`feat(db): update Project queries for stop_script`

## Notes
- This is a tedious task - carefully update each query
- The parameter numbering in INSERT/UPDATE must be correct
- Use search/replace carefully - there may be 4-6 queries to update
- After this task, the db crate should compile without errors
- Run `cargo fmt` after making changes to ensure consistent formatting
