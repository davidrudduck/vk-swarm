---
name: Add target_node_id to start_task_attempt MCP tool
status: open
created: 2026-01-19T12:00:00Z
updated: 2026-01-19T12:00:00Z
depends_on: []
conflicts_with: []
model_hint: simple
estimated_minutes: 15
---

# Task: Add target_node_id to start_task_attempt MCP tool

## Goal
Add `target_node_id` parameter to the existing `start_task_attempt` MCP tool.

## Context
The `start_task_attempt` tool currently doesn't allow specifying which node should execute the task. For swarm coordination, orchestrators need to be able to target specific nodes.

The tool already passes `target_node_id: None` to the backend (line 849). We just need to add the parameter and pass it through.

**File location**: `crates/server/src/mcp/task_server.rs`

**Existing code** (lines 191-202):
```rust
#[derive(Debug, Deserialize, schemars::JsonSchema)]
pub struct StartTaskAttemptRequest {
    #[schemars(description = "Task ID")]
    pub task_id: Uuid,
    #[schemars(description = "Executor: 'CLAUDE_CODE', 'CODEX', 'GEMINI', 'CURSOR_AGENT', 'OPENCODE'")]
    pub executor: String,
    #[schemars(description = "Executor variant (optional)")]
    pub variant: Option<String>,
    #[schemars(description = "Base branch")]
    pub base_branch: String,
}
```

**Tool implementation** (lines 800-866):
```rust
#[tool(description = "Start task execution with specified executor.")]
async fn start_task_attempt(
    &self,
    Parameters(StartTaskAttemptRequest {
        task_id,
        executor,
        variant,
        base_branch,
    }): Parameters<StartTaskAttemptRequest>,
) -> Result<CallToolResult, ErrorData> {
    ...
    let payload = CreateTaskAttemptBody {
        task_id,
        executor_profile_id,
        base_branch,
        target_node_id: None,  // <-- This needs to come from the request
        use_parent_worktree: None,
    };
    ...
}
```

## Steps
1. Add `target_node_id` field to `StartTaskAttemptRequest` struct (around line 201)
2. Update destructuring in `start_task_attempt` tool (around line 803)
3. Update payload creation to use the parameter (around line 845)

## Files to Modify
- `crates/server/src/mcp/task_server.rs` - Three small changes

## Code

### Step 1: Update StartTaskAttemptRequest struct

Find `StartTaskAttemptRequest` (around line 191) and add the new field:

Change:
```rust
#[derive(Debug, Deserialize, schemars::JsonSchema)]
pub struct StartTaskAttemptRequest {
    #[schemars(description = "Task ID")]
    pub task_id: Uuid,
    #[schemars(
        description = "Executor: 'CLAUDE_CODE', 'CODEX', 'GEMINI', 'CURSOR_AGENT', 'OPENCODE'"
    )]
    pub executor: String,
    #[schemars(description = "Executor variant (optional)")]
    pub variant: Option<String>,
    #[schemars(description = "Base branch")]
    pub base_branch: String,
}
```

To:
```rust
#[derive(Debug, Deserialize, schemars::JsonSchema)]
pub struct StartTaskAttemptRequest {
    #[schemars(description = "Task ID")]
    pub task_id: Uuid,
    #[schemars(
        description = "Executor: 'CLAUDE_CODE', 'CODEX', 'GEMINI', 'CURSOR_AGENT', 'OPENCODE'"
    )]
    pub executor: String,
    #[schemars(description = "Executor variant (optional)")]
    pub variant: Option<String>,
    #[schemars(description = "Base branch")]
    pub base_branch: String,
    #[schemars(
        description = "Target node ID for swarm execution. Use list_nodes to find available nodes."
    )]
    pub target_node_id: Option<Uuid>,
}
```

### Step 2: Update destructuring in tool

Find the `start_task_attempt` tool (around line 801) and update the destructuring:

Change:
```rust
Parameters(StartTaskAttemptRequest {
    task_id,
    executor,
    variant,
    base_branch,
}): Parameters<StartTaskAttemptRequest>,
```

To:
```rust
Parameters(StartTaskAttemptRequest {
    task_id,
    executor,
    variant,
    base_branch,
    target_node_id,
}): Parameters<StartTaskAttemptRequest>,
```

### Step 3: Update payload creation

Find the `CreateTaskAttemptBody` creation (around line 845) and update it:

Change:
```rust
let payload = CreateTaskAttemptBody {
    task_id,
    executor_profile_id,
    base_branch,
    target_node_id: None,
    use_parent_worktree: None,
};
```

To:
```rust
let payload = CreateTaskAttemptBody {
    task_id,
    executor_profile_id,
    base_branch,
    target_node_id,
    use_parent_worktree: None,
};
```

## Verification
- [ ] Run `cargo check -p server` - should succeed with no errors
- [ ] Tool schema includes `target_node_id` parameter
- [ ] Parameter is passed through to the backend

## Commit
`feat(mcp): add target_node_id to start_task_attempt tool`

## Notes
- The `target_node_id` is optional - if not provided, the backend will select a node automatically
- Orchestrators can use `list_nodes` tool to find available nodes for a project
- The node must be online and available for the task to be assigned to it
