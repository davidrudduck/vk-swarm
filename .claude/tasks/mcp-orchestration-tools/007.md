---
name: Add MCP list_templates tool
status: open
created: 2026-01-19T12:00:00Z
updated: 2026-01-19T12:00:00Z
depends_on: ["003"]
conflicts_with: []
model_hint: simple
estimated_minutes: 15
---

# Task: Add MCP list_templates tool

## Goal
Add MCP tool to list all templates (system + swarm + local).

## Context
The MCP server in `crates/server/src/mcp/task_server.rs` provides tools for AI orchestrators. We need to add a `list_templates` tool that calls the `GET /api/templates/all` endpoint.

**File location**: `crates/server/src/mcp/task_server.rs`

**Pattern for MCP tools**:
1. Define request/response structs with `#[derive(Debug, Serialize/Deserialize, schemars::JsonSchema)]`
2. Add tool function with `#[tool(description = "...")]` attribute
3. Use `self.send_json()` to call backend API
4. Return `TaskServer::success(&response)` or error

**Existing type sections** (around line 435-467):
```rust
// ===== Nodes MCP Types =====
...
#[derive(Debug, Serialize, schemars::JsonSchema)]
pub struct ListNodesResponse {...}
```

## Steps
1. Add Template MCP Types section after Nodes MCP Types (around line 467)
2. Add `list_templates` tool in the `#[tool_router] impl TaskServer` block

## Files to Modify
- `crates/server/src/mcp/task_server.rs` - Add types (after line 467), add tool (in impl block)

## Code

### Step 1: Add Template MCP Types

Add this after the Nodes MCP Types section (after `ListNodesResponse` around line 467):

```rust
// ===== Template MCP Types =====

#[derive(Debug, Serialize, schemars::JsonSchema)]
pub struct TemplateSummary {
    pub id: String,
    pub name: String,
    pub description: Option<String>,
    pub source: String,
}

#[derive(Debug, Serialize, schemars::JsonSchema)]
pub struct ListTemplatesResponse {
    pub templates: Vec<TemplateSummary>,
    pub count: usize,
}
```

### Step 2: Add list_templates tool

Find the `#[tool_router] impl TaskServer` block (starts around line 613). Add the tool near the end of the impl block, before the closing `}`. A good place is after the Labels tools (around line 1190):

```rust
    // ===== Template MCP Tools =====

    #[tool(description = "List all available templates (system + swarm + local).")]
    async fn list_templates(&self) -> Result<CallToolResult, ErrorData> {
        let url = self.url("/api/templates/all");

        #[derive(Deserialize)]
        struct UnifiedTemplate {
            id: String,
            name: String,
            description: Option<String>,
            source: String,
        }

        let templates: Vec<UnifiedTemplate> = match self.send_json(self.client.get(&url)).await {
            Ok(t) => t,
            Err(e) => return Ok(e),
        };

        let summaries: Vec<TemplateSummary> = templates
            .into_iter()
            .map(|t| TemplateSummary {
                id: t.id,
                name: t.name,
                description: t.description,
                source: t.source,
            })
            .collect();

        let response = ListTemplatesResponse {
            count: summaries.len(),
            templates: summaries,
        };

        TaskServer::success(&response)
    }
```

## Verification
- [ ] Run `cargo check -p server` - should succeed with no errors
- [ ] Tool shows in MCP tool list when server starts
- [ ] Tool returns templates from the `/api/templates/all` endpoint

## Commit
`feat(mcp): add list_templates tool`

## Notes
- The inner `UnifiedTemplate` struct is defined locally in the function to avoid importing from db crate
- We only include id, name, description, source in the response (not content) to keep responses small
- The `content` field is intentionally excluded - use `get_template` to fetch full content
- This tool has no parameters - it returns all templates
