---
name: Add Integration Test for Session Repair Flow
status: completed
created: 2026-01-19T04:59:32Z
updated: 2026-01-19T21:40:00Z
depends_on: [001, 002, 003]
conflicts_with: []
---

# Task: Add Integration Test for Session Repair Flow (Optional)

## Description
Add end-to-end integration test that validates the complete session repair â†’ lookup flow. This ensures the full feature works correctly from missing sessions through repair to successful lookup.

## Acceptance Criteria
- [x] Integration test added to session_index.rs
- [x] Test creates worktree with incomplete index
- [x] Test runs repair function
- [x] Test validates all sessions added to index
- [x] Test validates session lookup works
- [x] Test passes

## Technical Details
**File**: `crates/executors/src/executors/session_index.rs`

**Test Scenario**:
1. Create temporary worktree and Claude project directory
2. Create 3 session `.jsonl` files
3. Create incomplete index (only session-1)
4. Run `repair_sessions_index_with_home()`
5. Verify all 3 sessions now in index
6. Verify can lookup sessions by ID

**Implementation Pattern**:
- Use `tempfile::TempDir` for test isolation
- Create realistic session data
- Use `_with_home` variant for safe testing

## Dependencies
- Task 002 must be complete (needs `repair_sessions_index_with_home()`)

## Effort Estimate
- Size: S
- Hours: 0.5

## Definition of Done
- [x] Test function `test_integration_repair_then_lookup` exists
- [x] Test creates realistic test data
- [x] Test validates repair behaviour
- [x] Test validates lookup behaviour
- [x] `cargo test session_index --lib` passes
- [x] Code committed
