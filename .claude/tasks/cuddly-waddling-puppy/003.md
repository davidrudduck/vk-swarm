---
name: Add Remote Context to Message Queue Endpoints
status: done
created: 2026-01-11T11:04:49Z
updated: 2026-01-12T21:30:00Z
depends_on: []
conflicts_with: []
---

# Task: Add Remote Context to Message Queue Endpoints

## Description
Add `RemoteTaskAttemptContext` extraction to message queue handlers. For read operations, return empty array for remote tasks. For write operations, reject with BadRequest error since message queues are local-only.

## Acceptance Criteria
- [x] `list_queued_messages` includes `remote_ctx: Option<Extension<RemoteTaskAttemptContext>>`
- [x] Remote tasks return empty `Vec<QueuedMessage>` for list
- [x] `add_queued_message` rejects remote tasks with BadRequest
- [x] `reorder_queued_messages` rejects remote tasks with BadRequest
- [x] `clear_queued_messages` rejects remote tasks with BadRequest
- [x] Local behavior unchanged
- [x] Build passes with `cargo check`
- [x] Clippy passes

## Technical Details
- **File**: `crates/server/src/routes/message_queue.rs`
- **Pattern**: Follow `has_session_error` handler as reference for read operations
- Message queues are in-memory and local-only, so remote tasks have no local queue

## Changes Made
1. Added import for `RemoteTaskAttemptContext`
2. Updated `list_queued_messages` - returns empty vec for remote tasks
3. Updated `add_queued_message` - rejects remote tasks with BadRequest
4. Updated `reorder_queued_messages` - rejects remote tasks with BadRequest
5. Updated `clear_queued_messages` - rejects remote tasks with BadRequest

## Effort Estimate
- Size: XS
- Hours: 0.5

## Definition of Done
- [x] Code implemented
- [x] Read operations return empty for remote tasks
- [x] Write operations reject remote tasks
- [x] Build passes with `cargo check`
- [x] Clippy passes
- [x] Browser verification passed (local task attempts work correctly)

## Git Commit
- f15cc967d - feat: add remote context to message queue endpoints
