---
name: Add Missing Routes to by_task_id_router
status: open
created: 2026-01-11T11:04:49Z
updated: 2026-01-11T11:04:49Z
depends_on: []
conflicts_with: []
---

# Task: Add Missing Routes to by_task_id_router

## Description
Add the missing routes `/children`, `/has-session-error`, and `/fix-sessions` to the `by_task_id_router` in task_attempts/mod.rs. These routes are needed for node-to-node proxy requests.

## Acceptance Criteria
- [ ] Route `/children` added with GET method pointing to `get_task_attempt_children`
- [ ] Route `/has-session-error` added with GET method pointing to `has_session_error`
- [ ] Route `/fix-sessions` added with POST method pointing to `fix_sessions`
- [ ] Routes work with the `load_task_attempt_by_task_id_middleware`
- [ ] Proxy requests from other nodes succeed

## Technical Details
- **File**: `crates/server/src/routes/task_attempts/mod.rs` (line ~144-173)
- Add routes before the `.layer()` call

## Code Location
```rust
// Current by_task_id_router (line 144):
let by_task_id_router = Router::new()
    .route("/follow-up", post(follow_up))
    .route("/stop", post(stop_task_attempt_execution))
    .route("/branch-status", get(get_task_attempt_branch_status))
    // ... existing routes ...
    .route("/diff/ws", get(stream_task_attempt_diff_ws))
    // ADD THESE:
    .route("/children", get(get_task_attempt_children))
    .route("/has-session-error", get(has_session_error))
    .route("/fix-sessions", post(fix_sessions))
    .layer(from_fn_with_state(
        deployment.clone(),
        load_task_attempt_by_task_id_middleware,
    ));
```

## Dependencies
- [ ] None - can be added independently

## Effort Estimate
- Size: XS
- Hours: 0.25

## Definition of Done
- [ ] Routes added to by_task_id_router
- [ ] Build passes with `cargo check`
- [ ] Routes respond correctly to requests
