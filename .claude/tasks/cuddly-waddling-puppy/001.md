---
name: Add Remote Context to Children Endpoint
status: open
created: 2026-01-11T11:04:49Z
updated: 2026-01-11T11:04:49Z
depends_on: []
conflicts_with: []
---

# Task: Add Remote Context to Children Endpoint

## Description
Add `RemoteTaskAttemptContext` extraction to `get_task_attempt_children` handler and return empty `TaskRelationships` for remote tasks. This prevents HTTP 500 errors when viewing remote task attempts.

## Acceptance Criteria
- [ ] Handler signature includes `remote_ctx: Option<Extension<RemoteTaskAttemptContext>>`
- [ ] Remote tasks return empty TaskRelationships `{parent: None, children: []}`
- [ ] Local behavior unchanged (database query still performed)
- [ ] Return type changed from `StatusCode` to `ApiError` for consistency
- [ ] No HTTP 500 errors when accessing children endpoint for remote tasks

## Technical Details
- **File**: `crates/server/src/routes/task_attempts/handlers/core.rs` (line ~706)
- **Pattern**: Follow `stop_task_attempt_execution` handler as reference (line ~723)
- Add early return with empty TaskRelationships when `remote_ctx.is_some()`
- Import `RemoteTaskAttemptContext` from middleware module

## Code Location
```rust
// Current (line 706-721):
pub async fn get_task_attempt_children(
    Extension(task_attempt): Extension<TaskAttempt>,
    State(deployment): State<DeploymentImpl>,
) -> Result<ResponseJson<ApiResponse<TaskRelationships>>, StatusCode>

// Updated:
pub async fn get_task_attempt_children(
    Extension(task_attempt): Extension<TaskAttempt>,
    remote_ctx: Option<Extension<RemoteTaskAttemptContext>>,  // ADD
    State(deployment): State<DeploymentImpl>,
) -> Result<ResponseJson<ApiResponse<TaskRelationships>>, ApiError>  // Change StatusCode to ApiError
```

## Dependencies
- [ ] None - this is a standalone change

## Effort Estimate
- Size: XS
- Hours: 0.5

## Definition of Done
- [ ] Code implemented
- [ ] Handler returns empty relationships for remote tasks
- [ ] Error handling uses ApiError instead of StatusCode
- [ ] Build passes with `cargo check`
- [ ] Clippy passes
