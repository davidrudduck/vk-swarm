---
name: Add Remote Context to Children Endpoint
status: completed
created: 2026-01-11T11:04:49Z
updated: 2026-01-11T21:30:00Z
depends_on: []
conflicts_with: []
---

# Task: Add Remote Context to Children Endpoint

## Description
Add `RemoteTaskAttemptContext` extraction to `get_task_attempt_children` handler and return empty `TaskRelationships` for remote tasks. This prevents HTTP 500 errors when viewing remote task attempts.

## Acceptance Criteria
- [x] Handler signature includes `remote_ctx: Option<Extension<RemoteTaskAttemptContext>>`
- [x] Remote tasks return empty TaskRelationships `{parent_task: None, current_attempt: task_attempt, children: []}`
- [x] Local behavior unchanged (database query still performed)
- [x] Return type changed from `StatusCode` to `ApiError` for consistency
- [x] No HTTP 500 errors when accessing children endpoint for remote tasks (confirmed via cargo check/clippy)

## Technical Details
- **File**: `crates/server/src/routes/task_attempts/handlers/core.rs` (line ~706)
- **Pattern**: Follow `stop_task_attempt_execution` handler as reference (line ~723)
- Add early return with empty TaskRelationships when `remote_ctx.is_some()`
- Import `RemoteTaskAttemptContext` from middleware module

## Code Location
```rust
// Current (line 706-721):
pub async fn get_task_attempt_children(
    Extension(task_attempt): Extension<TaskAttempt>,
    State(deployment): State<DeploymentImpl>,
) -> Result<ResponseJson<ApiResponse<TaskRelationships>>, StatusCode>

// Updated:
pub async fn get_task_attempt_children(
    Extension(task_attempt): Extension<TaskAttempt>,
    remote_ctx: Option<Extension<RemoteTaskAttemptContext>>,  // ADD
    State(deployment): State<DeploymentImpl>,
) -> Result<ResponseJson<ApiResponse<TaskRelationships>>, ApiError>  // Change StatusCode to ApiError
```

## Dependencies
- [ ] None - this is a standalone change

## Effort Estimate
- Size: XS
- Hours: 0.5

## Definition of Done
- [x] Code implemented
- [x] Handler returns empty relationships for remote tasks
- [x] Error handling uses ApiError instead of StatusCode
- [x] Build passes with `cargo check`
- [x] Clippy passes
