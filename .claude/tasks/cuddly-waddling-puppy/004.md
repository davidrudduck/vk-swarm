---
name: Add Remote Context to Message Queue Endpoints
status: open
created: 2026-01-11T11:04:49Z
updated: 2026-01-11T11:04:49Z
depends_on: []
conflicts_with: []
---

# Task: Add Remote Context to Message Queue Endpoints

## Description
Add `RemoteTaskAttemptContext` extraction to message queue handlers. Return empty array for list operations on remote tasks and reject write operations with BadRequest error.

## Acceptance Criteria
- [ ] `list_queued_messages` returns empty array for remote tasks
- [ ] `add_queued_message` returns BadRequest for remote tasks
- [ ] `update_queued_message` returns BadRequest for remote tasks
- [ ] `remove_queued_message` returns BadRequest for remote tasks
- [ ] `reorder_queued_messages` returns BadRequest for remote tasks
- [ ] `clear_queued_messages` returns BadRequest for remote tasks
- [ ] Local behavior unchanged for all handlers
- [ ] No HTTP 500 errors when accessing message queue for remote tasks

## Technical Details
- **File**: `crates/server/src/routes/message_queue.rs`
- Message queue is in-memory/local - remote tasks have no local queue
- For `list_queued_messages`: Return empty vec when `remote_ctx.is_some()`
- For write operations: Return `ApiError::BadRequest("Cannot modify message queue for remote task attempts")`

## Code Changes Required
1. Import `RemoteTaskAttemptContext` from middleware
2. Update `list_queued_messages` to check remote_ctx and return empty vec
3. Update `add_queued_message` to reject remote tasks
4. Update `update_queued_message` to reject remote tasks
5. Update `remove_queued_message` to reject remote tasks
6. Update `reorder_queued_messages` to reject remote tasks
7. Update `clear_queued_messages` to reject remote tasks

## Dependencies
- [ ] None - message_queue.rs handlers are independent

## Effort Estimate
- Size: S
- Hours: 1

## Definition of Done
- [ ] All handlers updated with remote context checking
- [ ] List returns empty for remote tasks
- [ ] Write operations rejected for remote tasks
- [ ] Build passes with `cargo check`
- [ ] Clippy passes
