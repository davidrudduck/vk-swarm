---
name: Implement Batched Log Entry Deletion
status: done
created: 2026-01-16T04:56:56Z
updated: 2026-01-18T09:21:00Z
depends_on: []
conflicts_with: [004, 005, 006]
---

# Task: Implement Batched Log Entry Deletion

## Description
Replace single DELETE query with batched deletion for log entries to prevent long database locks on large purge operations.

## Acceptance Criteria
- [x] `delete_older_than` function rewritten to use batched deletes
- [x] Batch size set to 10,000 rows
- [x] 10ms yield between batches implemented
- [x] Function returns total deleted count
- [x] Clear documentation added

## Technical Details
- File: crates/db/src/models/log_entry/cleanup.rs
- Use loop with DELETE IN (SELECT ... LIMIT 10000)
- Add tokio::time::sleep(10ms) between batches
- Track total_deleted across iterations
- Import: `use std::time::Duration as StdDuration;`

## Dependencies
- None

## Effort Estimate
- Size: S
- Hours: 0.5

## Definition of Done
- [x] Batched delete implemented
- [x] SQLx cache regenerated
- [x] Unit test added
- [x] `cargo clippy` passes
- [x] `cargo test -p db` passes
- [x] Changes committed
