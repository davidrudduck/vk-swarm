---
name: Create Unit Tests for UserMessage Component
status: completed
created: 2026-01-12T00:33:13Z
updated: 2026-01-12T17:21:00Z
depends_on: []
conflicts_with: [003]
---

# Task: Create Unit Tests for UserMessage Component

## Description
Create a test file for the UserMessage component following TDD Red Phase. Write unit tests for the injected indicator feature including rendering conditions and accessibility attributes. Tests will initially fail (RED phase) and pass after Task 003 is complete.

## Acceptance Criteria
- [x] Test file created at `frontend/src/components/NormalizedConversation/__tests__/UserMessage.test.tsx`
- [x] All required mocks set up (react-i18next, hooks, contexts)
- [x] Test: renders injected indicator when metadata.injected is true
- [x] Test: does not render when metadata is null
- [x] Test: does not render when metadata is undefined
- [x] Test: does not render when metadata.injected is false
- [x] Test: has aria-label for accessibility
- [x] Test: renders message content

## Technical Details
- Use Vitest and @testing-library/react
- Mock dependencies:
  - react-i18next useTranslation hook
  - @/hooks/useProcessRetry
  - @/components/ConfigProvider useUserSystem
  - @/hooks/follow-up/useDraftStream
  - @/contexts/RetryUiContext

### Test Cases
1. `renders injected indicator when metadata.injected is true` - RED initially
2. `does not render injected indicator when metadata is null` - should pass
3. `does not render injected indicator when metadata is undefined` - should pass
4. `does not render injected indicator when metadata.injected is false` - should pass
5. `has aria-label for accessibility` - RED initially (no aria-label yet)
6. `renders message content` - should pass

## Dependencies
- [ ] None (can run in parallel with Task 001)

## Effort Estimate
- Size: S
- Hours: 1

## Definition of Done
- [x] Code implemented
- [x] Tests written and passing (5/6 passing, 1 RED as expected for TDD)
- [x] Documentation updated
- [x] Code reviewed
- [x] Deployed to staging
