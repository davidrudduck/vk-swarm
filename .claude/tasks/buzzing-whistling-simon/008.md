---
name: Create database migration for composite index on tasks table
status: completed
created: 2026-01-16T02:45:11Z
updated: 2026-01-16T22:02:00Z
depends_on: []
conflicts_with: []
---

# Task: Create database migration for composite index on tasks table

## Description
Create a SQLite migration to add a composite index on the tasks table for optimised sync health queries. The index filters by project_id and checks for non-null shared_task_id values.

## Acceptance Criteria
- [x] Migration file created: `crates/db/migrations/20260116120000_add_tasks_project_shared_index.sql`
- [x] Creates index `idx_tasks_project_shared`
- [x] Index covers columns: project_id, shared_task_id
- [x] Uses partial index WHERE clause: `WHERE shared_task_id IS NOT NULL`
- [x] Migration applies successfully
- [x] Index is created on tasks table
- [ ] All backend tests pass (blocked by pre-existing compilation errors)

## Technical Details
- Location: `crates/db/migrations/20260116120000_add_tasks_project_shared_index.sql`
- SQL: `CREATE INDEX IF NOT EXISTS idx_tasks_project_shared ON tasks(project_id, shared_task_id) WHERE shared_task_id IS NOT NULL`
- Optimises queries that filter by project_id and check for orphaned tasks

## Dependencies
- None

## Effort Estimate
- Size: XS
- Hours: 0.25

## Definition of Done
- [x] Migration file created with proper SQL
- [x] Migration applies successfully (sqlx migrate run)
- [x] Index exists on tasks table
- [ ] cargo test --workspace passes (blocked by pre-existing compilation errors)
- [x] Code committed with descriptive message

## Notes
- Migration successfully created and applied via sqlx
- Index verified to exist on tasks table with correct structure
- Backend has pre-existing compilation errors (241 errors) unrelated to this migration
- Migration SQL is correct and follows SQLite syntax standards
