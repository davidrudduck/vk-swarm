---
name: Fix variable expansion in container.rs
status: completed
created: 2026-01-23T09:31:15Z
updated: 2026-01-23T09:54:00Z
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Fix variable expansion in container.rs

## Description
Change the variable expansion function call in `container.rs` to include system variables. This affects initial task execution prompts sent to executors. Currently, system variables like `$TASK_ID`, `$PROJECT_ID`, and `$PARENT_TASK_ID` appear as literal strings instead of expanding to their actual values.

## Acceptance Criteria
- [x] Line 906 in `crates/services/src/services/container.rs` updated
- [x] Function call changed from `get_variable_map` to `get_variable_map_with_system`
- [x] Code compiles without errors
- [x] Existing tests continue to pass

## Technical Details

**File Location**: `crates/services/src/services/container.rs`

**Current Code (line 906)**:
```rust
let variables = TaskVariable::get_variable_map(&self.db().pool, task.id)
```

**Required Change**:
```rust
let variables = TaskVariable::get_variable_map_with_system(&self.db().pool, task.id)
```

**Why This Works**: The `get_variable_map_with_system` function includes all 8 system variables (TASK_ID, PARENT_TASK_ID, TASK_TITLE, TASK_DESCRIPTION, TASK_LABEL, PROJECT_ID, PROJECT_TITLE, IS_SUBTASK) in addition to user-defined variables.

**Context**: This code runs when an executor initially starts a task. The variables HashMap is used to expand `$VARIABLE_NAME` placeholders in the task description/prompt before sending it to the executor.

## Dependencies
- [x] None - this is a standalone change

## Effort Estimate
- Size: XS
- Hours: 0.25
- Parallel: true

## Definition of Done
- [x] Code change implemented at the exact line specified
- [x] `cargo build` completes successfully
- [x] `cargo test -p services` passes (note: pre-existing test failures in normalize_sync_test.rs unrelated to this change)
- [x] Code committed with descriptive message (commit 17b8b1b18)
